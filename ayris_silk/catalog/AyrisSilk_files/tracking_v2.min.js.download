// Tracking & SSEC & dataLayer (YM, GA4 (+Old sheme), TravelLine) - Version 2.3 / 2025.02.10 19:00:00
function sndsy_dataUpdate(e){sndsyApi.basketUpdate(e)}!function(e,s,t){function i(e){for(var s=window.location.search.substring(1).split("&"),t=0;t<s.length;t++){var i=s[t].split("=");if(decodeURIComponent(i[0])==e)return decodeURIComponent(i[1])}return!1}function r(e){for(var s=e+"=",t=document.cookie.split(";"),i=0;i<t.length;i++){for(var r=t[i];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(s))return"_sndsy_mid"==e?r.substring(s.length,r.length).split("").map((e=>1^e.charCodeAt(0))).map((e=>String.fromCharCode(e))).join(""):r.substring(s.length,r.length)}return null}function n(e,s,t){var i=s;"_sndsy_mid"==e&&s&&""!=s&&(i=i.split("").map((e=>1^e.charCodeAt(0))).map((e=>String.fromCharCode(e))).join(""),sndsyApi&&sndsyApi.isDevMode&&sndsyApi.log.ok(["[SET COOKIE]: "+e+" - "+i])),document.cookie=e+"="+i+"; path=/;domain=."+location.host.replace("www.","")+"; max-age="+t}function a(e){n(e,null,0)}function o(e){return new Promise(((s,t)=>{setTimeout((()=>{t(new Error(e))}),1)}))}function c(e){return!isNaN(parseFloat(e))&&isFinite(e)}function d(e){return void 0!==e}e[t]=e[t]||{},i("sendsay_debug")&&localStorage.setItem("SENDSAY_DEBUG",1),"undefined"!=typeof Storage&&(e[t].debug=!!localStorage.getItem("SENDSAY_DEBUG"));let l={_KEY_:"SSA_UD",_DEBUG:localStorage&&"1"==localStorage.getItem("SENDSAY_DEBUG")?1:0,isObject:function(e){return"object"==typeof e&&!Array.isArray(e)&&null!==e},_crypt:function(e){return e.split("").map((e=>1^e.charCodeAt(0))).map((e=>String.fromCharCode(e))).join("")},_encrypt:function(e){return e.split("").map((e=>1^e.charCodeAt(0))).map((e=>String.fromCharCode(e))).join("")},init:function(){this._DEBUG&&console.log("[UserDataStorage] init:",this);var e=this;if(void 0===this._STORAGE){this._DEBUG&&console.log("[UserDataStorage] try parse:",this);var s,t=localStorage.getItem(this._KEY_);try{s=JSON.parse(t),e._DEBUG&&console.log("[UserDataStorage] SUCCESS _storage:",s)}catch(s){e._DEBUG&&console.log("[UserDataStorage] FAIL _storage:",t)}s&&e.isObject(s)?e._STORAGE=s:function(){e._DEBUG&&console.log("[UserDataStorage] _init_storage:"),e._STORAGE={};var s=r("_sndsy_mid"),t=r("_sndsy_email");e._DEBUG&&console.log("mid: "+s,"_email: "+t),(s||t)&&(e._STORAGE.mid=e._crypt(t||s)),e.save()}()}},save:function(){this._DEBUG&&console.log("[UserDataStorage] save:",this._STORAGE),localStorage.setItem(this._KEY_,JSON.stringify(this._STORAGE))},setItem:function(e,s){var t=s;this._DEBUG&&console.log("[UserDataStorage] set:",arguments),this.init(),"mid"==e&&s&&""!=s&&(t=this._crypt(t)),this._STORAGE[e]=t,this.save()},getItem:function(e){return this.init(),this._DEBUG&&console.log("[UserDataStorage] get: "+e),this._STORAGE[e]&&"mid"==e?this._encrypt(this._STORAGE[e]):this._STORAGE[e]},removeItem:function(e){this.init(),this._DEBUG&&console.log("[UserDataStorage] remove: "+e),this._STORAGE[e]=void 0,delete this._STORAGE[e],this.save()},UMID_KEY:"SENDSAY_UMID_KEY",getUMID:function(){try{var e=localStorage.getItem(this.UMID_KEY);return e||(e=this.genUMID(),localStorage.setItem(this.UMID_KEY,e)),e}catch(e){return null}},genUMID:function(){return Array(4).fill(null).map((function(){return Math.random().toString(36).substr(2,8).toUpperCase()})).join("-")}};var u=function(o,u){var g=31536e3,p=(new Date).getTime(),h=function(){},y=function(){},m=new Promise((function(e,s){h=s=>{setTimeout((()=>{e(s)}),1)},y=e=>{setTimeout((()=>{s(new Error(e))}),1)}}));if(console.log("[Sendsay Data Send]:",(new Date).toLocaleString()),e[t].debug&&console.log("PARAMS:",u),e[t].debug&&console.group("Sendsay"),e[t].debug&&console.log("Call %s:",o,u),e[t].debug&&console.log("Env before:",e[t]),"init"===o){if(e[t].debug&&console.groupCollapsed("Init"),e[t].fid=u.fid,e[t].dhost=u.dhost||"link.sendsay.ru",e[t].dataLayerWatch=u.dataLayerWatch||!1,e[t].dataLayerScheme=u.dataLayerScheme||"ym",d(u.origin)&&c(u.origin)&&(e[t].origin=u.origin),e[t].debug&&console.log("Referrer:",s.referrer),s.referrer){var v=s.referrer.substr(s.referrer.indexOf("://")+3).split("?")[0].split("/"),E=[];v[3]&&(E=v[3].split(",")),e[t].debug&&console.log("Parse:",v),e[t].debug&&console.log("PLC:",E),v[3]&&v[1]&&E.length>3&&v[1]===e[t].fid&&(e[t].plc=v[3],e[t].host=v[0],n("_sndsy_fid",e[t].fid,g),n("_sndsy_host",e[t].host,g),0!=e[t].plc.indexOf("0,0,")?(e[t].debug&&console.log("[set] _sndsy_csdt: "+p),n("_sndsy_plc",e[t].plc,g),n("_sndsy_csdt",p,g)):(e[t].plc=void 0,delete e[t].plc),a("_sndsy_mid"),l.removeItem("mid"),e[t].debug&&console.log("[] Set cookie: ",document.cookie))}else if(r("_sndsy_fid")){e[t].debug&&console.log("[] Timeup cookie: ",document.cookie),n("_sndsy_fid",r("_sndsy_fid"),g),r("_sndsy_host")&&n("_sndsy_host",r("_sndsy_host"),g);var S=r("_sndsy_plc");S&&0!=S.indexOf("0,0,")&&n("_sndsy_plc",S,g)}let o=(i("sendsay_plc")||"").split(",");if(o.length>3&&o[0]===e[t].fid)n("_sndsy_plc",o.slice(1).join(","),g),n("_sndsy_csdt",p,g),e[t].plc=r("_sndsy_plc");else if(void 0===e[t].plc){var A=r("plc"),D=r("plc_dt");if(A){var f=A.split(",");f[0]===e[t].fid&&(n("_sndsy_plc",","+f.slice(1).join(","),g),n("_sndsy_csdt",D+"000",g),n("_sndsy_fid",f[0],g),e[t].plc=f.slice(1).join(","))}else r("_sndsy_fid")===e[t].fid&&(e[t].plc=r("_sndsy_plc"));e[t].debug&&console.log("Read cookie"),e[t].host=r("_sndsy_host")}e[t].debug&&console.groupEnd(),h({event:"init"})}else if("send"===o){e[t].debug&&console.groupCollapsed("Send");var C=("https:"==s.location.protocol?"https:":"http:")+"//";if(Array.isArray(u.dk)&&(u.dk=JSON.stringify(u.dk)),Array.isArray(u.ssec)&&_.isD(e[t].origin)&&_.isNumeric(e[t].origin)&&u.ssec.forEach(((s,i)=>{u.ssec[i].event_origin=e[t].origin})),e[t].debug&&Array.isArray(u.ssec)&&(console.log("SSEC:"),console.dir(JSON.parse(JSON.stringify(u.ssec)))),Array.isArray(u.ssec)&&(u.ssec=JSON.stringify(u.ssec)),u.url=u.url||s.location.href,u.url&&"NONE"!=u.url){const e=new URL(u.url),s=new URLSearchParams(e.search);s.delete("sendsay_plc"),e.search=s.toString(),u.url=e.toString()}void 0!==e[t].plc&&e[t].plc&&(u.plc=e[t].fid+","+e[t].plc),u.umid=l.getUMID(),void 0!==u.email&&u.email&&(e[t].debug&&console.log("[SET UDS] mid:",u.email),void 0!==u.dontCacheEmail&&u.dontCacheEmail||l.setItem("mid",u.email));var R=u.email||l.getItem("mid");u.plc&&""==u.plc||!R||(u.email=R),e[t].debug&&console.log("[FINISHED DATA]:",u);var T=new XMLHttpRequest,O=C+e[t].dhost+"/"+e[t].fid+"/0/?"+function(e){var s=[];for(var t in e)s.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return s.join("&")}(u),b=r("_sndsy_csdt");e[t].debug&&console.log("[Check] _sndsy_csdt:",b),b&&p-(b=parseInt(b,10))>432e6&&(e[t].debug&&console.log("_sndsy_plc:",e[t].plc),O+="&ii=1"),e[t].debug&&console.log("Url: ",O),e[t].debug&&console.log("Params: ",u);try{T.open("GET",O,!0),T.send(),e[t].debug&&console.log("Sent")}catch(e){console.error("Sendsay tracking error. URL: "+O),y({key:"xhr_error"})}T.onload=function(s){e[t].debug&&console.log("[xhr] onload"),h(s)},T.onerror=function(s){e[t].debug&&console.log("[xhr] onerror:",O,u),y(s)},T.onabort=function(s){e[t].debug&&console.log("[xhr] onabort:",O,u),y(s)},e[t].debug&&console.groupEnd()}return e[t].debug&&console.log("Env after: ",e[t]),e[t].debug&&console.groupEnd(),m};for(var g in e.sndsy.q)u.apply(null,e.sndsy.q[g]);e.sndsy=u;var _={UDS:l,getQuery:function(e){return i(e)},copyObj:function(e,s){return JSON.parse(JSON.stringify(e))},isNumeric:c,isU:function(e){return void 0===e},isD:d,toInt:function(e){return"number"==typeof e?e:parseInt(e,10)},validEmail:function(e){return/^(([^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,})$/iu.test(e)},isEmail:function(e){return/^(([^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,})$/iu.test(e)},validPhone:function(e){return/^(\s*)?(\+)?([- _():=+]?\d[- _():=+]?){10,14}(\s*)?$/.test(e)},isPhone:function(e){return/^(\s*)?(\+)?([- _():=+]?\d[- _():=+]?){10,14}(\s*)?$/.test(e)},isDateTime:function(e){return/^(19|20)\d\d-((0[1-9]|1[012])-(0[1-9]|[12]\d)|(0[13-9]|1[012])-30|(0[13578]|1[02])-31) ([0-1]\d|2[0-3])(:[0-5]\d){2}$/.test(e)},isUrl:function(e){return/^(http[s]*:\/\/.)[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)$/i.test(e)},isObject:function(e){return"object"==typeof e&&!Array.isArray(e)&&null!==e},typeOf:function(e){return{}.toString.call(e).match(/\s(\w+)/)[1].toLowerCase()},readCookie:r,setCookie:n,unsetCookie:a,getUMID:function(){return l.getUMID()},getEmail:function(){return l.getItem("mid")||void 0},setEmail:function(e){l.setItem("mid",e)},getMemberId:function(){let[e,s,t,i]=(sndsyApi.readCookie("_sndsy_plc")||"").split(",");return i},log:{styles:{base:["color: #fff","background-color: #444","padding: 2px 4px","border-radius: 2px"],error:["color: #eee","background-color: red"],success:["background-color: green"],warning:["background-color: #ba930a","color: black"]},msg:function(e,s){var t;s=s||"base",t=this.styles.base.join(";")+";",s&&"base"!=s&&(t+=this.styles[s].join(";")),Array.isArray(e)?e.forEach((function(e){"object"==typeof e?console.log(e):console.log(`%c${e}`,t)})):"object"==typeof e?console.log(e):console.log(`%c${e}`,t)},ok:function(e){this.msg(e,"success")},err:function(e){this.msg(e,"error")},warn:function(e){this.msg(e,"warning")},warnSSecValue:function(e,s,t,i){this.warn(["[ssecEvent:"+e+'] wrong value "'+s+'" ('+i+" is expected)"]),this.msg(t)}},isDevMode:!1,setDevMode:function(e){var s=!this.isD(e)||e;"undefined"!=typeof localStorage&&(localStorage[s?"setItem":"removeItem"]("SENDSAY_DEBUG",1),this.log.msg("SENDSAY_DEBUG is "+(s?"ON":"OFF"),s?"success":"error")),this.isDevMode=s},dateFormat:function(e){var s=e||new Date;this.isU(e)&&s.setHours(s.getHours()+3);var t=function(e){return parseInt(e,10)<10?"0"+e:e},i=s.getUTCFullYear(),r=s.getUTCMonth()+1,n=(e=s.getUTCDate(),s.getUTCHours()),a=s.getUTCMinutes(),o=s.getUTCSeconds();return i+"-"+t(r)+"-"+t(e)+" "+t(n)+":"+t(a)+":"+t(o)},addData:function(e,s){var t={dk:[[this.ADD_KEY||sndsyData.ADD_KEY,"merge",s]]};this.isDevMode&&console.log("Send: ",t),this.send("send",t)},SSEC_EVENTS_LIST:{ORDER:1,VIEW_PRODUCT:0,VIEW_CATEGORY:2,BASKET_ADD:3,BASKET_UPDATE:3,BASKET_CLEAR:4,SEARCH_PRODUCT:5,SUBSCRIBE_PRODUCT_PRICE:6,SUBSCRIBE_PRODUCT_ISA:7,FAVORITE:8,PREORDER:12,PRODUCT_ISA:13,PREORDER_PRODUCT_ISA:14,PRODUCT_PRICE_CHANGED:15,REGISTRATION:28,AUTHORIZATION:29},ssecCP_Set:function(e,s){return this.isDevMode&&this.log.msg(["[ssecCP_Set]",arguments]),e.forEach(((e,t)=>{let i=1;do{let r="cp"+i;this.isD(e[r])&&e[r]&&(s[t][r]=e[r]),i++}while(i<21)})),this.isDevMode&&this.log.msg(["ssec_data:",s]),s},ssecSettingServiceParams:function(e,s){let t=s||{};return this.isD(t.dontCacheEmail)&&t.dontCacheEmail&&(e.dontCacheEmail=!0),this.isD(t.email)&&t.email&&""!=t.email&&(e.email=t.email),this.isD(t.event_origin)&&this.isNumeric(t.event_origin)&&e.ssec.forEach(((s,i)=>{e.ssec[i].event_origin=t.event_origin})),e},ssecValidation:function(e,s,t){var i=this,r=!1;t=t||{};if(this.log.msg(["ssecValidation: "+e,s]),["SUBSCRIBE_PRODUCT_ISA","SUBSCRIBE_PRODUCT_PRICE","PRODUCT_ISA","VIEW_PRODUCT","PREORDER","FAVORITE","PRODUCT_PRICE_CHANGED"].includes(e))this.isDevMode&&console.log("[ssecValidation] PRODUCT TYPE"),this.isD(s.action)&&0==s.action?(this.isU(s.id)||""==s.id)&&(r=!0,this.log.err(["[ssecEvent:"+e+'] undefined "id" (String is expected)',s.id]),this.log.msg(s.id)):((this.isU(s.id)||""==s.id)&&(r=!0,this.log.err(["[ssecEvent:"+e+'] undefined "id" (String is expected)',s.id]),this.log.msg(s.id)),this.isD(s.available)&&![0,1].includes(s.available)&&this.log.warnSSecValue(e,"available",s.available,"1 or 0"),this.isD(s.old_price)&&!this.isNumeric(s.old_price)&&this.log.warnSSecValue(e,"old_price",s.old_price,"Number"),["model","description"].forEach((function(t){!i.isD(s[t])||"string"==typeof s[t]&&""!=s[t]||i.log.warnSSecValue(e,t,s[t],"String")})),!this.isU(s.price)&&this.isNumeric(s.price)||this.log.warnSSecValue(e,"price",s.price,"Number"),(i.isU(s.name)||"string"!=typeof s.name||""==s.name)&&i.log.warnSSecValue(e,"name",s.name,"String"),t.dataLayerWatchMode||((i.isU(s.vendor)||"string"!=typeof s.vendor||""==s.vendor)&&i.log.warnSSecValue(e,"vendor",s.vendor,"String"),!this.isU(s.picture)&&Array.isArray(s.picture)||this.log.warnSSecValue(e,"picture",s.picture,"Array<String>"),!this.isU(s.url)&&this.isUrl(s.url)||this.log.warnSSecValue(e,"url",s.url,"URL-string")));else if("SEARCH_PRODUCT"==e)this.isU(s.description)&&(r=!0,this.log.err(["[ssecEvent:"+e+'] wrong value "description" (String is expected)']),this.log.msg(s));else if("VIEW_CATEGORY"==e){let i=!0,r=!0;t.dataLayerWatchMode?i=!1:!this.isU(s.category_id)&&this.isNumeric(s.category_id)||(i=!1,this.log.warnSSecValue(e,"category_id",s.category_id,"Number")),!this.isD(s.category)||"string"==typeof s.category&&""!=s.category||(r=!1,this.log.warnSSecValue(e,"category",s.category,"String")),i||r||this.log.err(["[ssecEvent:"+e+'] unknown value "category_id" and "category" (One of the parameters is expected)']),this.isD(s.category_paths)&&!Array.isArray(s.category_paths)&&this.log.warnSSecValue(e,"category_paths",s.category_paths,"Array<string>")}else"BASKET_ADD"==e?(this.isU(s.items)||!Array.isArray(s.items)?(r=!0,this.log.err(["[ssecEvent:"+e+'] wrong value "items" (Array is expected)']),this.log.msg(s.items)):s.items.forEach((function(s){(i.isU(s.id)||""==s.id)&&(r=!0,i.log.err(["[ssecEvent:"+e+'] wrong value "item.id" (String is expected)']),i.log.msg(s.id)),(i.isU(s.qnt)||i.isD(s.qnt)&&!i.isNumeric(s.qnt))&&(r=!0,i.log.err(["[ssecEvent:"+e+'] wrong value "item.qnt" (Number is expected)']),i.log.msg(s.qnt)),(i.isU(s.price)||i.isD(s.price)&&!i.isNumeric(s.price))&&(r=!0,i.log.err(["[ssecEvent:"+e+'] wrong value "item.price" (Number is expected)']),i.log.msg(s.price)),(i.isU(s.name)||"string"!=typeof s.name||""==s.name)&&i.log.warnSSecValue(e,"name",s.name,"String"),!i.isD(s.vendor)||"string"==typeof s.vendor&&""!=s.vendor||i.log.warnSSecValue(e,"vendor",s.vendor,"String"),i.isD(s.picture)&&!Array.isArray(s.picture)&&i.log.warnSSecValue(e,"picture",s.picture,"Array<String>"),i.isD(s.url)&&!i.isUrl(s.url)&&i.log.warnSSecValue(e,"url",s.url,"URL-string")})),!this.isD(s.transaction_id)||""!=s.transaction_id&&"string"==typeof s.transaction_id||this.log.warnSSecValue(e,"transaction_id",s.transaction_id,"String"),this.isD(s.transaction_dt)&&!this.isDateTime(s.transaction_dt)&&this.log.warnSSecValue(e,"transaction_dt",s.transaction_dt,'Datetime string "YYYY-MM-DD hh:mm:ss"'),this.isD(s.update_per_item)&&!this.isNumeric(s.update_per_item)&&this.log.warnSSecValue(e,"update_per_item",s.update_per_item,"Number"),!this.isU(s.transaction_sum)&&this.isNumeric(s.transaction_sum)||this.log.warnSSecValue(e,"transaction_sum",s.transaction_sum,"Number")):"ORDER"==e&&((this.isU(s.transaction_id)||""==s.transaction_id)&&(r=!0,this.log.err(["[ssecEvent:"+e+'] undefined "transaction_id" (String is expected)']),this.log.msg(s.transaction_id)),!this.isU(s.transaction_dt)&&this.isDateTime(s.transaction_dt)||(r=!0,this.log.err(["[ssecEvent:"+e+'] wrong value "transaction_dt" (Datetime string "YYYY-MM-DD hh:mm:ss" is expected)']),this.log.msg(s.transaction_dt)),!this.isU(s.transaction_status)&&this.isNumeric(s.transaction_status)||(r=!0,this.log.err(["[ssecEvent:"+e+'] wrong value "transaction_status" (Number expected)']),this.log.msg(s.transaction_status)),!this.isU(s.transaction_sum)&&this.isNumeric(s.transaction_sum)||this.log.warnSSecValue(e,"transaction_sum",s.transaction_sum,"Number"),this.isD(s.update)&&1==s.update?this.isD(s.items)&&Array.isArray(s.items)&&0==s.items.length&&(r=!0,this.log.err(["[ssecEvent:"+e+"](update="+s.update+') wrong value "items" (Array[{id,qnt,price}] is expected)']),this.log.msg(s.data)):!this.isU(s.items)&&Array.isArray(s.items)&&0!=s.items.length||(r=!0,this.log.err(["[ssecEvent:"+e+"](update="+s.update+') wrong value "items" (Array[{id,qnt,price}] is expected)']),this.log.msg(s.data)),this.isD(s.items)&&Array.isArray(s.items)&&s.items.length&&s.items.forEach((function(s){(i.isU(s.id)||""==s.id)&&(r=!0,i.log.err(["[ssecEvent:"+e+'] wrong value "item.id" (String is expected)']),i.log.msg(s.id)),(i.isU(s.qnt)||i.isD(s.qnt)&&!i.isNumeric(s.qnt))&&(r=!0,i.log.err(["[ssecEvent:"+e+'] wrong value "item.qnt" (Number is expected)']),i.log.msg(s.qnt)),(i.isU(s.price)||i.isD(s.price)&&!i.isNumeric(s.price))&&(r=!0,i.log.err(["[ssecEvent:"+e+'] wrong value  "item.price" (Number is expected)']),i.log.msg(s.price))})),["payment_dt","delivery_dt"].forEach((function(t){i.isD(s[t])&&!i.isDateTime(s[t])&&i.log.warnSSecValue(e,t,s[t],'Datetime string "YYYY-MM-DD hh:mm:ss"')})));return!r},ssecEvent:function(e,s,t,i){var r={ORDER:"Order",VIEW_PRODUCT:"ViewProduct",VIEW_CATEGORY:"ViewCategory",BASKET_ADD:"BasketAdd",BASKET_UPDATE:"BasketUpdate",BASKET_CLEAR:"BasketClear",SEARCH_PRODUCT:"SearchProduct",SUBSCRIBE_PRODUCT_PRICE:"SubscribeProductPrice",SUBSCRIBE_PRODUCT_ISA:"SubscribeProductISA",PREORDER:"PreOrder",PRODUCT_ISA:"ProductISA",PREORDER_PRODUCT_ISA:"PreOrderProductISA",PRODUCT_PRICE_CHANGED:"ProductPriceChanged",REGISTRATION:"Registration",AUTHORIZATION:"Authorization"}[e]||!1;i=i||{};return this.isD(t)&&this.isD(t.event_origin)&&!this.isNumeric(t.event_origin)?(this.log.err(["[ssecEvent:"+e+'] wrong value "event_origin" (Number expected)']),this.log.msg(t),o({key:"wrong_event_origin"})):this.isD(s)&&this.isD(s.event_origin)&&!this.isNumeric(s.event_origin)?(this.log.err(["[ssecEvent:"+e+'] wrong value "event_origin" (Number expected)']),this.log.msg(s),o({key:"wrong_event_origin"})):"SUBSCRIBE_PRODUCT_ISA"==e?this.isD(s.add)?this.ssecEvent_SubscribeProductISA(s.add,t||void 0,i):this.isD(s.clear)?this.ssecEvent_ClearSubscribeProductISA(t||void 0,i):this.isD(s.delete)?this.ssecEvent_DeleteSubscribeProductISA(s.delete,t||void 0,i):this.isD(s)&&Array.isArray(s)?this.ssecEvent_SubscribeProductISA(s,t||void 0,i):console.warn('[sndsyApi] "'+e+'" wrong data'):"SUBSCRIBE_PRODUCT_PRICE"==e?this.isD(s.add)?this.ssecEvent_SubscribeProductPrice(s.add,t||void 0,i):this.isD(s.clear)?this.ssecEvent_ClearSubscribeProductPrice(t||void 0,i):this.isD(s.delete)?this.ssecEvent_DeleteSubscribeProductPrice(s.delete,t||void 0,i):this.isD(s)&&Array.isArray(s)?this.ssecEvent_SubscribeProductPrice(s,t||void 0,i):console.warn('[sndsyApi] "'+e+'" wrong data'):"FAVORITE"==e?this.isD(s.add)?this.ssecEvent_Favorite(s.add,t||void 0,i):this.isD(s.clear)?this.ssecEvent_ClearFavorite(t||void 0,i):this.isD(s.delete)?this.ssecEvent_DeleteFavorite(s.delete,t||void 0,i):this.isD(s)&&Array.isArray(s)?this.ssecEvent_Favorite(s,t||void 0,i):console.warn('[sndsyApi] "'+e+'" wrong data'):"PREORDER"==e?(this.isDevMode&&this.log.msg(["ssecEvent data:",s,t]),this.isD(s.add)?this.ssecEvent_PreOrder(s.add,t||void 0,i):this.isD(s.clear)?this.ssecEvent_ClearPreOrder(t||void 0,i):this.isD(s.delete)?this.ssecEvent_DeletePreOrder(s.delete,t||void 0,i):this.isD(s)&&Array.isArray(s)?this.ssecEvent_PreOrder(s,t||void 0,i):(console.warn('[sndsyApi] "'+e+'" wrong data'),o({key:"wrong_data"}))):(this.log.msg([e,r]),r&&"function"==typeof this["ssecEvent_"+r]?this["ssecEvent_"+r].call(this,s,t,i):(console.warn('[sndsyApi] "'+e+'" unknown'),o({key:"unknown_event_type"})))},_ssecEventLikePoduct:function(e,s,t){this.isDevMode&&this.log.msg(["[_ssecEventLikePoduct] call: ",arguments]);var i=this,r=s||{},n=s.event_type,a=(s.event_origin,this.isD(r.action)?r.action:1),c=!0,d={ssec:[],url:"NONE"};if(this.isD(e.dk)&&(d.dk=e.dk),Array.isArray(e)&&e.length?(e.forEach((function(e,s){"object"==typeof e?(e.event_type=i.SSEC_EVENTS_LIST[n],e.action=a,d.ssec.push(e)):i.isD(e)?d.ssec.push({id:e,event_type:i.SSEC_EVENTS_LIST[n],action:a}):console.warn("Event _ssecEvent["+n+"] ["+s+'] "id" undefined')})),d.ssec=this.ssecCP_Set(e,d.ssec)):i.isD(e)&&d.ssec.push({id:e,event_type:i.SSEC_EVENTS_LIST[n],action:a}),e.forEach((function(e,s){i.ssecValidation(n,e,t)||(c=!1)})),this.isD(r.extra)&&r.extra){for(var l in r.extra)d[l]=r.extra[l];if(r.extra&&r.extra.testing_mute)return this.log.msg(["[CALL] _ssecEvent["+n+"]",arguments,"Data:",d]),o({key:"testing_mute"})}return this.isDevMode&&this.log.msg(["[_ssecEventLikePoduct] _send_data: ",d]),d=this.ssecSettingServiceParams(d,r),c&&d.ssec.length?(this.isDevMode&&this.log.ok(["[_ssecEvent]["+n+"] Send: ",d]),this.send("send",d)):o({key:"wrong_data"})},ssecEvent_ViewProduct:function(e,s,t){var i=Object.assign(s||{},{event_type:"VIEW_PRODUCT"});return this._ssecEventLikePoduct(e,i,t)},ssecEvent_PreOrder:function(e,s,t){var i=Object.assign(s||{},{event_type:"PREORDER",action:1});return this._ssecEventLikePoduct(e,i,t)},_ssecEvent_DeletePreOrder:function(e,s,t){!this.isU(data_id)&&this.isNumeric(data_id)||(this.log.err(["[ssecEvent:PREORDER/DELETE] wrong value id (Number is expected)"]),this.log.msg(g.price),_is_verified=!1);var i=Object.assign(s||{},{event_type:"PREORDER",action:0});return this._ssecEventLikePoduct(data,i,t)},ssecEvent_DeletePreOrder:function(e,s,t){var i=this,r=s||{},n=!0,a={ssec:[],url:"NONE"};if(Array.isArray(e)?e.forEach((function(s){i.isNumeric(s)||(i.log.err(['[ssecEvent_DeletePreOrder] wrong value "id" (Number is expected)']),i.log.msg(e),n=!1),a.ssec.push({event_type:i.SSEC_EVENTS_LIST.PREORDER,id:s,action:0})})):(!this.isU(e)&&this.isNumeric(e)||(this.log.err(['[ssecEvent_DeletePreOrder] wrong value "id" (Number is expected)']),this.log.msg(e),n=!1),a.ssec.push({event_type:this.SSEC_EVENTS_LIST.PREORDER,id:e,action:0})),this.isD(r.extra)&&r.extra){for(var c in r.extra)a[c]=r.extra[c];if(r.extra&&r.extra.testing_mute)return this.log.msg(["[CALL] ssecEvent_DeletePreOrder",arguments,"Data:",a]),o({key:"testing_mute"})}return n?(a=this.ssecSettingServiceParams(a,r),this.isDevMode&&console.log("[ssecEvent_DeletePreOrder] Send: ",a),this.send("send",a)):o({key:"wrong_data"})},ssecEvent_ClearPreOrder:function(e,s){var t=e||{},i={ssec:[{event_type:this.SSEC_EVENTS_LIST.PREORDER,action:0}],url:"NONE"};if(this.isD(t.extra)&&t.extra){for(var r in t.extra)i[r]=t.extra[r];if(t.extra&&t.extra.testing_mute)return this.log.msg(["[CALL] ssecEvent_ClearPreOrder",arguments,"Data:",i]),o({key:"testing_mute"})}return i=this.ssecSettingServiceParams(i,t),this.isDevMode&&console.log("[ssecEvent_ClearPreOrder] Send: ",i),this.send("send",i)},ssecEvent_ProductISA:function(e,s,t){var i=Object.assign(s||{},{event_type:"PRODUCT_ISA"});return this._ssecEventLikePoduct(e,i)},ssecEvent_Order:function(e,s,t){var i=this,r=Array.isArray(e)?e[0]:this.copyObj(e),n=s||{},a=!0,c={ssec:[{event_type:this.SSEC_EVENTS_LIST.ORDER}],url:"NONE"};if(Array.isArray(e)||this.log.warn("[ssecEvent_Order] Move to array data"),this.isDevMode&&console.log("_data:",r),this.ssecValidation("ORDER",r)||(a=!1),this.isU(r.transaction_id)||!r.transaction_id?(a=!1,console.warn('ssecEvent_Order "transaction_id" undefined')):c.ssec[0].transaction_id=r.transaction_id,this.isU(r.transaction_dt)||!this.isDateTime(r.transaction_dt)?(a=!1,console.warn('ssecEvent_Order "transaction_dt" wrong or undefined')):c.ssec[0].transaction_dt=r.transaction_dt,["payment_dt","delivery_dt","delivery_price","update","transaction_dt","transaction_sum","transaction_status","transaction_discount"].forEach((function(e){i.isD(r[e])&&r[e]&&(c.ssec[0][e]=r[e])})),this.isD(r.items)&&Array.isArray(r.items)&&(0==r.items.length?c.ssec[0].items=[]:r.items.forEach((function(e){i.isD(e.id)&&i.isD(e.qnt)&&i.isD(e.price)&&(c.ssec[0].items?c.ssec[0].items.push(e):c.ssec[0].items=[e])})),c.ssec=this.ssecCP_Set(e,c.ssec)),this.isD(n.extra)&&n.extra){for(var d in n.extra)c[d]=n.extra[d];if(n.extra&&n.testing_mute)return this.isDevMode&&this.log.msg(["[CALL] ssecEvent_Order",arguments,"Data:",c]),o({key:"testing_mute"})}return c=this.ssecSettingServiceParams(c,n),a?(this.isDevMode&&this.log.ok(["[ssecEvent][ORDER] Send: ",c]),this.send("send",c)):o({key:"wrong_data"})},ssecEvent_ViewCategory:function(e,s,t){var i=this,r=!0,n=s||{},a={ssec:[],url:"NONE"};if(e.forEach((function(e,s){i.ssecValidation("VIEW_CATEGORY",e,t)?(e.event_type=i.SSEC_EVENTS_LIST.VIEW_CATEGORY,a.ssec.push(e)):r=!1})),a.ssec=this.ssecCP_Set(e,a.ssec),this.isD(n.extra)&&n.extra){for(var c in n.extra)a[c]=n.extra[c];if(n.extra&&n.testing_mute)return this.isDevMode&&this.log.msg(["[CALL] ssecEvent_ViewCategory",arguments,"Data:",a]),o({key:"testing_mute"})}return a=this.ssecSettingServiceParams(a,n),r?(this.isDevMode&&this.log.ok(["[ssecEvent][VIEW_CATEGORY] Send: ",a]),this.send("send",a)):o({key:"wrong_data"})},ssecEvent_BasketUpdate:function(){return this.ssecEvent_BasketAdd.apply(this,arguments)},ssecEvent_BasketAdd:function(e,s,t){var i=Array.isArray(e)?e[0]:e,r=this,n=!0,a=s||{},c={ssec:[{event_type:r.SSEC_EVENTS_LIST.BASKET_ADD}],url:"NONE"};if(!this.ssecValidation("BASKET_ADD",i))return n=!1,o({key:"wrong_data"});if(Array.isArray(e)||console.warn("[ssecEvent_BasketAdd] Move to array data"),c.ssec=this.ssecCP_Set(e,c.ssec),["transaction_id","transaction_dt","transaction_sum"].forEach((function(e){r.isD(i[e])&&i[e]&&(c.ssec[0][e]=i[e])})),this.isD(i.update_per_item)&&(c.ssec[0].update_per_item=i.update_per_item),this.isDevMode&&this.log.msg(["[CALL] ssecEvent_BasketAdd data:",i]),this.isD(i.items)&&Array.isArray(i.items)&&(0==i.items.length?c.ssec[0].items=[]:i.items.forEach((function(e){r.isD(e.id)&&r.isD(e.qnt)&&r.isD(e.price)&&(c.ssec[0].items?c.ssec[0].items.push(e):c.ssec[0].items=[e])}))),this.isDevMode&&this.log.ok("_is_verified: "+n),this.isD(a.extra)&&a.extra){for(var d in a.extra)c[d]=a.extra[d];if(a.extra&&this.isD(a.testing_mute)&&a.testing_mute)return this.log.msg(["[CALL] ssecEvent_BasketAdd",arguments,"Data:",c]),o({key:"testing_mute"})}return c=this.ssecSettingServiceParams(c,a),n?(this.isDevMode&&this.log.ok(["[ssecEvent][BASKET_ADD] Send: ",c]),this.send("send",c)):o({key:"wrong_data"})},ssecEvent_BasketClear:function(e,s){var t=e||{},i={ssec:[{items:[{id:"-1"}],event_type:this.SSEC_EVENTS_LIST.BASKET_CLEAR}],url:"NONE"};if(this.isD(t.extra)&&t.extra){for(var r in t.extra)i[r]=t.extra[r];if(t.extra&&t.testing_mute)return this.log.msg(["[CALL] ssecEvent_BasketClear",arguments,"Data:",i]),o({key:"testing_mute"})}return i=this.ssecSettingServiceParams(i,t),this.isDevMode&&this.log.ok(["[ssecEvent][BASKET_CLEAR] Send: ",i]),this.send("send",i)},ssecEvent_SearchProduct:function(e,s,t){var i=Object.assign(s||{},{event_type:"SEARCH_PRODUCT"});return this._ssecEventLikePoduct(e,i,t)},ssecEvent_SubscribeProductPrice:function(e,s,t){var i=Object.assign(s||{},{event_type:"SUBSCRIBE_PRODUCT_PRICE",action:1});return this._ssecEventLikePoduct(e,i,t)},ssecEvent_ProductPriceChanged:function(e,s,t){var i=this,r=s||{},n={ssec:[],url:"NONE"};if(e.forEach((function(e){(i.isU(e.id)||""==e.id)&&(i.log.err(['[ssecEvent_ProductPriceChanged] wrong value "id" (String is expected)']),i.log.msg(e.id),!1),i.isNumeric(e.old_price)||(i.log.err(['[ssecEvent_ProductPriceChanged] wrong value "old_price" (Number is expected)']),i.log.msg(e.old_price),!1),i.isNumeric(e.price)||(i.log.err(['[ssecEvent_ProductPriceChanged] wrong value "price" (Number is expected)']),i.log.msg(e.price),!1),n.ssec.push(Object.assign({},e,{event_type:i.SSEC_EVENTS_LIST.PRODUCT_PRICE_CHANGED}))})),n.ssec=this.ssecCP_Set(e,n.ssec),this.isD(r.extra)&&r.extra){for(var a in r.extra)n[a]=r.extra[a];if(r.extra&&r.extra.testing_mute)return this.log.msg(["[CALL] ssecEvent_ProductPriceChanged",arguments,"Data:",n]),o({key:"testing_mute"})}return n=this.ssecSettingServiceParams(n,r),this.isDevMode&&console.log("[ssecEvent_ProductPriceChanged] Send: ",n),this.send("send",n)},ssecEvent_DeleteSubscribeProductPrice:function(e,s,t){var i=this,r=s||{},n={ssec:[],url:"NONE"};if(this.isDevMode&&this.log.msg(["[CALL] ssecEvent_DeleteSubscribeProductPrice:",arguments]),Array.isArray(e)?e.forEach((function(s){i.isNumeric(s)||(i.log.err(['[ssecEvent_DeleteSubscribeProductPrice] wrong value "id" (Number is expected)']),i.log.msg(e),!1),n.ssec.push({event_type:i.SSEC_EVENTS_LIST.SUBSCRIBE_PRODUCT_PRICE,id:s,action:0})})):(!this.isU(e)&&this.isNumeric(e)||(this.log.err(['[ssecEvent_DeleteSubscribeProductPrice] wrong value "id" (Number is expected)']),this.log.msg(e),!1),n.ssec.push({event_type:this.SSEC_EVENTS_LIST.SUBSCRIBE_PRODUCT_PRICE,id:e,action:0})),this.isD(r.extra)&&r.extra){for(var a in r.extra)n[a]=r.extra[a];if(r.extra&&r.extra.testing_mute)return this.log.msg(["[CALL] ssecEvent_DeleteSubscribeProductPrice",arguments,"Data:",n]),o({key:"testing_mute"})}return n=this.ssecSettingServiceParams(n,r),this.isDevMode&&console.log("[ssecEvent_DeleteSubscribeProductPrice] Send: ",n),this.send("send",n)},ssecEvent_ClearSubscribeProductPrice:function(e,s){var t=e||{},i={ssec:[{event_type:this.SSEC_EVENTS_LIST.SUBSCRIBE_PRODUCT_PRICE,action:0}],url:"NONE"};if(this.isD(t.extra)&&t.extra){for(var r in t.extra)i[r]=t.extra[r];if(t.extra&&t.extra.testing_mute)return this.log.msg(["[CALL] ssecEvent_ClearSubscribeProductPrice",arguments,"Data:",i]),o({key:"testing_mute"})}return i=this.ssecSettingServiceParams(i,t),this.isDevMode&&console.log("[ssecEvent][SUBSCRIBE_PRODUCT_PRICE] Send: ",i),this.send("send",i)},ssecEvent_SubscribeProductISA:function(e,s,t){var i=Object.assign(s||{},{event_type:"SUBSCRIBE_PRODUCT_ISA",action:1});return this._ssecEventLikePoduct(e,i,t)},ssecEvent_DeleteSubscribeProductISA:function(e,s,t){var i=this,r=s||{},n=!0,a={ssec:[],url:"NONE"};if(Array.isArray(e)?e.forEach((function(s){i.isNumeric(s)||(i.log.err(['[ssecEvent_DeleteSubscribeProductISA] wrong value "id" (Number is expected)']),i.log.msg(e),n=!1),a.ssec.push({event_type:i.SSEC_EVENTS_LIST.SUBSCRIBE_PRODUCT_ISA,id:s,action:0})})):(!this.isU(e)&&this.isNumeric(e)||(this.log.err(['[ssecEvent_DeleteSubscribeProductISA] wrong value "id" (Number is expected)']),this.log.msg(e),n=!1),a.ssec.push({event_type:this.SSEC_EVENTS_LIST.SUBSCRIBE_PRODUCT_ISA,id:e,action:0})),this.isD(r.extra)&&r.extra){for(var c in r.extra)a[c]=r.extra[c];if(r.extra&&r.extra.testing_mute)return this.log.msg(["[CALL] ssecEvent_DeleteSubscribeProductISA",arguments,"Data:",a]),o({key:"testing_mute"})}return n?(a=this.ssecSettingServiceParams(a,r),this.isDevMode&&console.log("[ssecEvent_DeleteSubscribeProductISA] Send: ",a),this.send("send",a)):o({key:"wrong_data"})},ssecEvent_ClearSubscribeProductISA:function(e,s){var t=e||{},i={ssec:[{event_type:this.SSEC_EVENTS_LIST.SUBSCRIBE_PRODUCT_ISA,action:0}],url:"NONE"};if(this.isD(t.extra)&&t.extra){for(var r in t.extra)i[r]=t.extra[r];if(t.extra&&t.extra.testing_mute)return this.log.warn(["[CALL] ssecEvent_ClearSubscribeProduct",arguments,"Data:",i]),o({key:"testing_mute"})}return i=this.ssecSettingServiceParams(i,t),this.isDevMode&&console.log("[ssecEvent][SUBSCRIBE_PRODUCT_ISA] Send: ",i),this.send("send",i)},ssecEvent_Favorite:function(e,s,t){var i=Object.assign(s||{},{event_type:"FAVORITE",action:1});return this._ssecEventLikePoduct(e,i,t)},ssecEvent_DeleteFavorite:function(e,s,t){var i=this,r=s||{},n=!0,a={ssec:[],url:"NONE"};if(Array.isArray(e)?(e.length||(i.log.err(['[ssecEvent_DeleteFavorite] wrong value "id" ([]String is expected)']),i.log.msg(e),n=!1),e.forEach((function(s){s||(i.log.err(['[ssecEvent_DeleteFavorite] wrong value "id" (String is expected)']),i.log.msg(e),n=!1),a.ssec.push({event_type:i.SSEC_EVENTS_LIST.FAVORITE,id:s,action:0})}))):(!this.isU(e)&&e||(this.log.err(['[ssecEvent_DeleteFavorite] wrong value "id" (String is expected)']),this.log.msg(e),n=!1),a.ssec.push({event_type:this.SSEC_EVENTS_LIST.FAVORITE,id:e,action:0})),this.isD(r.extra)&&r.extra){for(var c in r.extra)a[c]=r.extra[c];if(r.extra&&r.extra.testing_mute)return this.log.msg(["[CALL] ssecEvent_DeleteFavorite",arguments,"Data:",a]),o({key:"testing_mute"})}return n?(a=this.ssecSettingServiceParams(a,r),this.isDevMode&&console.log("[ssecEvent_DeleteFavorite] Send: ",a),this.send("send",a)):o({key:"wrong_data"})},ssecEvent_ClearFavorite:function(e,s){var t=e||{},i={ssec:[{event_type:this.SSEC_EVENTS_LIST.FAVORITE,action:0}],url:"NONE"};if(this.isD(t.extra)&&t.extra){for(var r in t.extra)i[r]=t.extra[r];if(t.extra&&t.extra.testing_mute)return this.log.warn(["[CALL] ssecEvent_ClearFavorite",arguments,"Data:",i]),o({key:"testing_mute"})}return i=this.ssecSettingServiceParams(i,t),this.isDevMode&&this.log.ok(["[ssecEvent][FAVORITE] CLEAR Send: ",i]),this.send("send",i)},ssecEvent_Registration:function(e,s){var t=e||{},i={ssec:[{event_type:this.SSEC_EVENTS_LIST.REGISTRATION}],url:"NONE"};if(this.isD(t.extra)&&t.extra){for(var r in t.extra)i[r]=t.extra[r];if(t.extra&&t.extra.testing_mute)return this.log.warn(["[CALL] ssecEvent_Registration",arguments,"Data:",i]),o({key:"testing_mute"})}return i=this.ssecSettingServiceParams(i,t),this.isD(t.dk)&&t.dk&&(i.dk=t.dk),this.isDevMode&&this.log.ok(["[ssecEvent][REGISTRATION] Send: ",i]),this.send("send",i)},ssecEvent_Authorization:function(e,s){var t=e||{},i={ssec:[{event_type:this.SSEC_EVENTS_LIST.AUTHORIZATION}],url:"NONE"};if(this.isD(t.extra)&&t.extra){for(var r in t.extra)i[r]=t.extra[r];if(t.extra&&t.extra.testing_mute)return this.log.warn(["[CALL] ssecEvent_Authorization",arguments,"Data:",i]),o({key:"testing_mute"})}return i=this.ssecSettingServiceParams(i,t),this.isDevMode&&this.log.ok(["[ssecEvent][AUTHORIZATION] Send: ",i]),this.send("send",i)},TravelLineCatch:function(e,s,t){this.isDevMode&&console.log("[sndsyApi] TravelLineCatch:",arguments);let i=this.TravelLineCallback(e,t||function(){});"function"==typeof i?i(s):console.warn("[sndsyApi.TravelLineCatch] что-то пошло не так =/")},TravelLineCallback:function(e,s){let t=this;return"onBookingSuccess"==e?function(e){let t=[],i=e.customerEmail||"",r={};i&&(sndsyApi.setEmail(i),r.email=i),e.roomTypes&&e.roomTypes.length&&(t=e.roomTypes.map((e=>({id:e.id,name:e.name,price:e.price,qnt:1,description:e.rateName})))),this.isDevMode&&console.log("onBookingSuccess",t),t.length?sndsyApi.ssecEvent("ORDER",[{transaction_id:e.bookingNumber,transaction_sum:e.price,transaction_status:1,transaction_dt:sndsyApi.dateFormat(),items:t}],r).then((()=>{"function"==typeof s&&s.apply(window,[e])})):"function"==typeof s&&s.apply(window,[e])}:"onBookingStepChanged"==e?function(e){"search"==e.step?sndsyApi.ssecEvent("VIEW_CATEGORY",[{category:"search",category_id:0}]).then((()=>{"function"==typeof s&&s.apply(window,[e])})):"preview"==e.step?sndsyApi.ssecEvent("VIEW_PRODUCT",[{id:"product1"}]).then((()=>{"function"==typeof s&&s.apply(window,[e])})):"payment"==e.step?sndsyApi.ssecEvent("BASKET_ADD",[{items:[{id:"product1",qnt:1,price:0}]}]).then((()=>{"function"==typeof s&&s.apply(window,[e])})):("complete"==e.step||sndsyApi.log.warn(["[TravelLineCallback] unknown step",e]),"function"==typeof s&&s.apply(window,[e]))}:function(i){t.log.warn(["[sndsyApi.TravelLineCallback] unknown event: "+e]),"function"==typeof s&&s.apply(window,[i])}},setData:function(e,s){if(this.isDevMode&&console.log("sndsyApi:setData ...",e),e){var t=window,i=s||{},r={dk:[[this.SET_KEY||(this.isD(t.sndsyData)&&t.sndsyData.SET_KEY?t.sndsyData.SET_KEY:void 0),"set",e]],ssec:e,is_basket:1,url:"NONE"};for(var n in i)r[n]=i[n];return this.isDevMode&&this.log.ok(["Send: ",r]),this.send("send",r)}},send:function(e,s){window;return""==location.host?this.log("action: "+e,"data:",s):(this.isDevMode&&this.log.ok(["sndsyApi -> send()",arguments]),u(e,s))},dkSend:function(e){var s={is_basket:0,url:"NONE"},t=this,i={dk:[[e.key,e.action,e.options]]};if(e.options)for(var r in e.options)i[r]=e.options[r];return Object.keys(s).forEach((function(e){t.isU(i[e])&&(i[e]=s[e])})),this.isDevMode&&this.log.ok("dkSend: ",i),this.send("send",i)},basketUpdate:function(e,s,t){this.isDevMode&&console.log("Call sndsyApi.basketUpdate ...");t=t||{};var i={datetime:sndsyApi.dateFormat(),id:t.id||"",items:{},summ:0,payment_datetime:t.payment_datetime||""};for(var r in e){var n=e[r];for(var a in i.items[n.id]={},e[r]){var o=a;"qty"!=a&&"quantity"!=a||(o="count"),i.items[n.id][o]=e[r][a]}this.isU(i.items[n.id].price)||this.isU(i.items[n.id].count)||(i.summ+=this.toInt(i.items[n.id].price)*this.toInt(i.items[n.id].count))}return sndsyApi.setData(i,s||{})},basketClear:function(e){this.isDevMode&&console.log("Call sndsyApi.basketClear ...");var s=Object.assign(e||{},{ssec:[{items:[{id:"-1"}],event_type:this.SSEC_EVENTS_LIST.BASKET_CLEAR}],url:"NONE"});return this.basketUpdate({},s||{})},runQueue:function(){this.isDevMode&&console.log("[runQueue] sndsyApiOnReady:",window.sndsyApiOnReady),void 0!==window.sndsyApiOnReady&&Array.isArray(window.sndsyApiOnReady)&&(this.isDevMode&&console.log("CALL from sndsyApiOnReady:"),this.isDevMode&&console.log(window.sndsyApiOnReady),window.sndsyApiOnReady.forEach((function(e){e.apply(window,[])})),this.isDevMode&&console.log("CLEAR sndsyApiOnReady:"),window.sndsyApiOnReady=[])},rq:function(){this.runQueue()}};for(var p in e.sndsyApi=e.sndsyApi||{},_)e.sndsyApi[p]=e.sndsyApi[p]||_[p];try{var h=localStorage.getItem("SENDSAY_DEBUG");void 0!==h&&h&&(e.sndsyApi.log.ok("SENDSAY_DEBUG is ON"),e.sndsyApi.isDevMode=!0)}catch(e){}if(e.sndsyApi.runQueue(),e[t].dataLayerWatch){let i,r=e[t].dataLayerWatch;if("string"==typeof r){if(!Array.isArray(e[r]))return _.log.err(["[dataLayerWatcher] wrong key for watching",r]);i=e[r]}else{if("boolean"!=typeof r)return _.log.err(["[dataLayerWatcher] wrong dataLayerWatcher value",r]);if(void 0===e.dataLayer)return _.log.err(["[dataLayerWatcher] dataLayer is undefined"]);i=e.dataLayer}let n=function(e){let s=[];if(sndsyApi.isD(e.impressions)&&Array.isArray(e.impressions)){let t=!1;if(0==e.impressions.length)return sndsyApi.log.err(["[ssecEvent:dataLayer(YM) -> VIEW_CATEGORY] wrong impressions (Array is expected)"]),void sndsyApi.log.msg(e.impressions);if(sndsyApi.isU(e.impressions[0].category)||"string"!=typeof e.impressions[0].category||""==e.impressions[0].category?(t=!0,sndsyApi.log.err(['[ssecEvent:dataLayer -> VIEW_CATEGORY] unknown value "category" (String is expected)',e.impressions[0]])):s.push({category:e.impressions[0].category}),t)return;sndsyApi.ssecEvent("VIEW_CATEGORY",s,{},{dataLayerWatchMode:!0})}if(sndsyApi.isD(e.detail)){let t=!1;if((!Array.isArray(e.detail.products)||sndsyApi.isD(e.detail.products)&&0==e.detail.products.length)&&(t=!0,sndsyApi.log.err(["[ssecEvent:dataLayer(YM) -> VIEW_PRODUCT] wrong products (Array is expected)"]),sndsyApi.log.msg(e.detail)),e.detail.products.forEach((e=>{sndsyApi.isU(sndsyApi.isD(e.id))||""==e.id?(t=!0,sndsyApi.log.err(['[ssecEvent:dataLayer(YM) -> VIEW_PRODUCT] undefined "id" (String is expected)',e.id])):s.push({id:e.id,name:e.name||void 0,price:e.price||void 0,description:e.brand||void 0,category:e.category||void 0}),(sndsyApi.isU(e.name)||"string"!=typeof e.name||""==e.name)&&sndsyApi.log.warnSSecValue("dataLayer(YM) -> VIEW_PRODUCT","name",e.name,"String"),!sndsyApi.isU(e.price)&&sndsyApi.isNumeric(e.price)||sndsyApi.log.warnSSecValue("dataLayer(YM) -> VIEW_PRODUCT","price",e.price,"Number")})),t)return;sndsyApi.ssecEvent("VIEW_PRODUCT",s,{},{dataLayerWatchMode:!0})}let t=function(e,s){let t=!1,i=s.event,r=s.remove||!1;return(sndsyApi.isU(e.id)||""==e.id)&&(t=!0,sndsyApi.log.err(["[ssecEvent:dataLayer(YM) -> "+i+'] wrong value "id" (String is expected)']),sndsyApi.log.msg(e)),r||((sndsyApi.isU(e.quantity)||sndsyApi.isD(e.quantity)&&!sndsyApi.isNumeric(e.quantity))&&(t=!0,sndsyApi.log.err(["[ssecEvent:dataLayer(YM) -> "+i+'] wrong value "quantity" (Number is expected)']),sndsyApi.log.msg(_d)),(sndsyApi.isU(e.price)||sndsyApi.isD(e.price)&&!sndsyApi.isNumeric(e.price))&&(t=!0,sndsyApi.log.err(["[ssecEvent:dataLayer(YM) -> "+i+'] wrong value "price" (Number is expected)']),sndsyApi.log.msg(e))),(sndsyApi.isU(e.name)||"string"!=typeof e.name||""==e.name)&&sndsyApi.log.warnSSecValue("dataLayer(YM) -> "+i,"name",e.name,"String"),!t};if(sndsyApi.isD(e.add)){let i=!1;if((!Array.isArray(e.add.products)||sndsyApi.isD(e.add.products)&&0==e.add.products.length)&&(i=!0,sndsyApi.log.err(["[ssecEvent:dataLayer(YM) -> BASKET_ADD] wrong products (Array is expected)"]),sndsyApi.log.msg(e.add)),e.add.products.forEach((e=>{t(e,{event:"BASKET_ADD"})?s.push({update_per_item:1,items:[{id:e.id,name:e.name||void 0,price:e.price,qnt:e.quantity,description:e.brand||void 0,category:e.category||void 0}]}):i=!0})),i)return;sndsyApi.ssecEvent("BASKET_ADD",s,{},{dataLayerWatchMode:!0})}if(sndsyApi.isD(e.remove)){let i=!1;if(_items=[],(!Array.isArray(e.remove.products)||sndsyApi.isD(e.remove.products)&&0==e.remove.products.length)&&(i=!0,sndsyApi.log.err(["[ssecEvent:dataLayer(YM) -> BASKET_ADD] wrong products (Array is expected)"]),sndsyApi.log.msg(e.remove)),e.remove.products.forEach((e=>{t(e,{event:"BASKET_ADD",remove:!0})?_items.push({id:e.id,name:e.name||void 0,price:0,description:e.brand||void 0,qnt:0,category:e.category||void 0}):i=!0})),i)return;_items.length&&s.push({transaction_sum:0,update_per_item:1,items:_items}),sndsyApi.ssecEvent("BASKET_ADD",s,{},{dataLayerWatchMode:!0})}if(sndsyApi.isD(e.checkout)){let i=e.checkout,r=!1;if((sndsyApi.isU(i.products)||!Array.isArray(i.products)||sndsyApi.isD(i.products)&&0==i.products.length)&&(r=!0,sndsyApi.log.err(['[ssecEvent:dataLayer(YM) -> BASKET_ADD] undefined or wrong "products" (Array is expected)']),sndsyApi.log.msg(i)),!r){let e=0,n=i.products.reduce((function(s,i){return r||(t(i,{event:"BASKET_ADD"})?(e+=parseInt(i.quantity,10)*parseInt(i.price,10),s.push({id:i.id,name:i.name||void 0,price:i.price,qnt:i.quantity,description:i.brand||void 0,category:i.category||void 0})):r=!0),s}),[]);r||(s.push({transaction_sum:e,items:n}),sndsyApi.ssecEvent("BASKET_ADD",s,{},{dataLayerWatchMode:!0}))}}if(sndsyApi.isD(e.purchase)){let i=e.purchase,r=!1;if((sndsyApi.isU(i.actionField)||sndsyApi.isU(i.actionField.id)||""==i.actionField.id)&&(r=!0,sndsyApi.log.err(['[ssecEvent:dataLayer(YM) -> ORDER] undefined "actionField.id" (String is expected)']),sndsyApi.log.msg(i)),(sndsyApi.isU(i.products)||!Array.isArray(i.products)||sndsyApi.isD(i.products)&&0==i.products.length)&&(r=!0,sndsyApi.log.err(['[ssecEvent:dataLayer(YM) -> ORDER] undefined or wrong "products" (Array is expected)']),sndsyApi.log.msg(i)),!r){let e=0,n=i.products.reduce((function(s,i){return r||(t(i,{event:"ORDER"})?(e+=parseInt(i.quantity,10)*parseInt(i.price,10),s.push({id:i.id,name:i.name||void 0,price:i.price,qnt:i.quantity,description:i.brand||void 0,category:i.category||void 0})):r=!0),s}),[]);r||(s.push({transaction_id:i.actionField.id,transaction_sum:e,transaction_status:1,transaction_dt:sndsyApi.dateFormat(),items:n}),sndsyApi.ssecEvent("ORDER",s,{},{dataLayerWatchMode:!0}))}}},a=function(e,t,i){sndsyApi.isDevMode&&sndsyApi.log.warn(["[CALL] ga4_catch():",{action:e,event:t,data:i}]);let r={add_to_wishlist:"FAVORITE",view_item_list:"VIEW_CATEGORY",view_item:"VIEW_PRODUCT",add_to_cart:"BASKET_ADD",remove_from_cart:"BASKET_ADD",purchase:"ORDER"},n=[],a=!1,o="ssecEvent:dataLayer(GA4)",c=function(e,t){let i=!1,r=t.event,n=t.remove||!1;return(sndsyApi.isU(e.item_id)||""==e.item_id)&&(i=!0,sndsyApi.log.err(["["+o+" -> "+r+'] wrong value "item_id" (String is expected)',e])),0==n&&((sndsyApi.isU(e.quantity)||sndsyApi.isD(e.quantity)&&!sndsyApi.isNumeric(e.quantity))&&(i=!0,sndsyApi.log.err(["["+o+"  -> "+r+'] wrong value "quantity" (Number is expected)',e])),(sndsyApi.isU(e.price)||sndsyApi.isD(e.price)&&!sndsyApi.isNumeric(e.price))&&(i=!0,sndsyApi.log.err(["["+o+"  -> "+r+'] wrong value "price" (Number is expected)',e]))),(sndsyApi.isU(e.item_name)||"string"!=typeof e.item_name||""==e.item_name)&&sndsyApi.log.warnSSecValue(o+" -> "+r,"item_name",s.item_name,"String"),!i};if(["view_item_list","view_item","add_to_cart","remove_from_cart","purchase","add_to_wishlist"].includes(t)){if(!Array.isArray(i.items))return sndsyApi.log.err(["["+o+" -> "+r[t]+'] wrong "items" (Array is expected)']),void sndsyApi.log.msg(i);if(["view_item","add_to_wishlist"].includes(t)){i.items.forEach((e=>{sndsyApi.isU(sndsyApi.isD(e.item_id))||"string"!=typeof e.item_id||""==e.item_id?(a=!0,sndsyApi.log.err(["["+o+" -> "+r[t]+'] undefined "item_id" (String is expected)',e.id])):n.push({id:e.item_id,name:e.item_name||void 0,price:e.price||void 0,description:e.item_brand||e.item_variant||void 0}),(sndsyApi.isU(e.item_name)||"string"!=typeof e.item_name||""==e.item_name)&&sndsyApi.log.warnSSecValue(o+" -> "+r[t],"item_name",e.name,"String"),!sndsyApi.isU(e.price)&&sndsyApi.isNumeric(e.price)||sndsyApi.log.warnSSecValue(o+" -> "+r[t],"price",e.price,"Number")})),a||sndsyApi.ssecEvent(r[t],n,{},{dataLayerWatchMode:!0})}else if("add_to_cart"==t){let e=[],s=0;i.items.forEach((t=>{c(t,{event:"BASKET_ADD"})?(e.push({id:t.item_id,name:t.item_name||void 0,price:t.price,qnt:t.quantity,description:t.item_brand||t.item_variant||void 0}),s+=t.quantity*t.price):a=!0})),a||(n.push({update_per_item:1,items:e}),sndsyApi.ssecEvent("BASKET_ADD",n,{},{dataLayerWatchMode:!0}))}else if("remove_from_cart"==t){let e=[];i.items.forEach((s=>{c(s,{event:"BASKET_ADD",remove:!0})?e.push({id:s.item_id,name:s.item_name||void 0,price:0,qnt:0,description:s.item_brand||s.item_variant||void 0}):a=!0})),a||(n.push({transaction_sum:0,update_per_item:1,items:e}),sndsyApi.ssecEvent("BASKET_ADD",n,{},{dataLayerWatchMode:!0}))}else if("purchase"==t){if((sndsyApi.isU(i.transaction_id)||""==i.transaction_id)&&(a=!0,sndsyApi.log.err(["["+o+' -> ORDER] undefined "transaction_id" (String is expected)']),sndsyApi.log.msg(i)),!a){let e=0,s=i.items.reduce((function(s,t){return a||(c(t,{event:"ORDER"})?(e+=parseInt(t.quantity,10)*parseInt(t.price,10),s.push({id:t.item_id,name:t.item_name||void 0,price:t.price,qnt:t.quantity,description:t.item_brand||t.item_variant||void 0})):a=!0),s}),[]);a||(n.push({transaction_id:i.transaction_id,transaction_sum:e,transaction_status:1,transaction_dt:sndsyApi.dateFormat(),items:s}),sndsyApi.ssecEvent("ORDER",n,{},{dataLayerWatchMode:!0}))}}else if("view_item_list"==t){let e=[];(sndsyApi.isU(i.item_list_name)||"string"!=typeof i.item_list_name||""==i.item_list_name)&&(a=!0,sndsyApi.log.err(["["+o+' -> VIEW_CATEGORY] undefined "item_list_name" (String is expected)']),sndsyApi.log.msg(i)),Array.isArray(i.items)&&i.items.length&&(e=["","1","2","3","4","5"].reduce(((e,s)=>{let t=i.items[0]["item_category"+s]||!1;return t&&e.push(t),e}),[])),a||sndsyApi.ssecEvent("VIEW_CATEGORY",[{category:i.item_list_name,category_paths:e}],{},{dataLayerWatchMode:!0})}}};i.length&&(sndsyApi.isDevMode&&console.groupCollapsed("[Sendsay] dataLayer check before init proxy"),i.forEach((s=>{"ym"==e[t].dataLayerScheme&&sndsyApi.isObject(s)&&s.ecommerce?(sndsyApi.isDevMode&&sndsyApi.log.msg(["dataLayer before init",s]),n(s.ecommerce)):"ga4"==e[t].dataLayerScheme&&("arguments"==sndsyApi.typeOf(s)&&"event"==s[0]&&"string"==typeof s[1]&&sndsyApi.isObject(s[2])?(sndsyApi.isDevMode&&sndsyApi.log.msg(["dataLayer before init",s]),a("event",s[1],s[2])):"object"==sndsyApi.typeOf(s)&&"string"==typeof s.event&&sndsyApi.isObject(s.ecommerce)&&(sndsyApi.isDevMode&&sndsyApi.log.msg(["dataLayer before init proxy",s]),a("event",s.event,s.ecommerce)))})),sndsyApi.isDevMode&&console.groupEnd("[Sendsay] dataLayer check before init proxy")),i.push=new Proxy(i.push,{apply:function(s,i,r){return sndsyApi.isDevMode&&sndsyApi.log.msg(["dataLayer.push",r]),"ym"==e[t].dataLayerScheme&&r.length&&r[0]&&r[0].ecommerce?n(r[0].ecommerce):"ga4"==e[t].dataLayerScheme&&r.length&&(r[0].event&&r[0].ecommerce?(sndsyApi.isDevMode&&sndsyApi.log.msg(["by dataLayer.push method"]),a.apply(null,["event",r[0].event,r[0].ecommerce])):r[0].length&"event"==r[0][0]&&r[0][1]&&r[0][2]?(sndsyApi.isDevMode&&sndsyApi.log.msg(["by gtag function"]),a.apply(null,[r[0][0],r[0][1],r[0][2]])):r[0]&&r[0].ecommerce&&(sndsyApi.isDevMode&&sndsyApi.log.warn(["Try to Yandex Metrika scheme"]),n(r[0].ecommerce))),s.apply(i,r)}})}sndsyApi.isDevMode&&(sndsyApi.log.msg(["Sendsay Tracking v.2025.02.10 19:00:00"]),e[t].debug=!0)}(window,document,"sndsy_params");