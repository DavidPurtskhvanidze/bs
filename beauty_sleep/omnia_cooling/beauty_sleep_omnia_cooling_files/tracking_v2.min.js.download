// Tracking & SSEC & dataLayer (YM, GA4 (+Old sheme), TravelLine) - Version 2.2 / 2024.11.12 11:30:00
function sndsy_dataUpdate(e){sndsyApi.basketUpdate(e)}!function(e,t,s){function i(e){for(var t=window.location.search.substring(1).split("&"),s=0;s<t.length;s++){var i=t[s].split("=");if(decodeURIComponent(i[0])==e)return decodeURIComponent(i[1])}return!1}function n(e){for(var t=e+"=",s=document.cookie.split(";"),i=0;i<s.length;i++){for(var n=s[i];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return"_sndsy_mid"==e?n.substring(t.length,n.length).split("").map((e=>1^e.charCodeAt(0))).map((e=>String.fromCharCode(e))).join(""):n.substring(t.length,n.length)}return null}function r(e,t,s){var i=t;"_sndsy_mid"==e&&t&&""!=t&&(i=i.split("").map((e=>1^e.charCodeAt(0))).map((e=>String.fromCharCode(e))).join(""),sndsyApi&&sndsyApi.isDevMode&&sndsyApi.log.ok(["[SET COOKIE]: "+e+" - "+i])),document.cookie=e+"="+i+"; path=/;domain=."+location.host.replace("www.","")+"; max-age="+s}function a(e){r(e,null,0)}function o(e){return new Promise(((t,s)=>{setTimeout((()=>{s(new Error(e))}),1)}))}e[s]=e[s]||{},i("sendsay_debug")&&localStorage.setItem("SENDSAY_DEBUG",1),"undefined"!=typeof Storage&&(e[s].debug=!!localStorage.getItem("SENDSAY_DEBUG"));let c={_KEY_:"SSA_UD",_DEBUG:localStorage&&"1"==localStorage.getItem("SENDSAY_DEBUG")?1:0,isObject:function(e){return"object"==typeof e&&!Array.isArray(e)&&null!==e},_crypt:function(e){return e.split("").map((e=>1^e.charCodeAt(0))).map((e=>String.fromCharCode(e))).join("")},_encrypt:function(e){return e.split("").map((e=>1^e.charCodeAt(0))).map((e=>String.fromCharCode(e))).join("")},init:function(){this._DEBUG&&console.log("[UserDataStorage] init:",this);var e=this;if(void 0===this._STORAGE){this._DEBUG&&console.log("[UserDataStorage] try parse:",this);var t,s=localStorage.getItem(this._KEY_);try{t=JSON.parse(s),e._DEBUG&&console.log("[UserDataStorage] SUCCESS _storage:",t)}catch(t){e._DEBUG&&console.log("[UserDataStorage] FAIL _storage:",s)}t&&e.isObject(t)?e._STORAGE=t:function(){e._DEBUG&&console.log("[UserDataStorage] _init_storage:"),e._STORAGE={};var t=n("_sndsy_mid"),s=n("_sndsy_email");e._DEBUG&&console.log("mid: "+t,"_email: "+s),(t||s)&&(e._STORAGE.mid=e._crypt(s||t)),e.save()}()}},save:function(){this._DEBUG&&console.log("[UserDataStorage] save:",this._STORAGE),localStorage.setItem(this._KEY_,JSON.stringify(this._STORAGE))},setItem:function(e,t){var s=t;this._DEBUG&&console.log("[UserDataStorage] set:",arguments),this.init(),"mid"==e&&t&&""!=t&&(s=this._crypt(s)),this._STORAGE[e]=s,this.save()},getItem:function(e){return this.init(),this._DEBUG&&console.log("[UserDataStorage] get: "+e),this._STORAGE[e]&&"mid"==e?this._encrypt(this._STORAGE[e]):this._STORAGE[e]},removeItem:function(e){this.init(),this._DEBUG&&console.log("[UserDataStorage] remove: "+e),this._STORAGE[e]=void 0,delete this._STORAGE[e],this.save()},UMID_KEY:"SENDSAY_UMID_KEY",getUMID:function(){try{var e=localStorage.getItem(this.UMID_KEY);return e||(e=this.genUMID(),localStorage.setItem(this.UMID_KEY,e)),e}catch(e){return null}},genUMID:function(){return Array(4).fill(null).map((function(){return Math.random().toString(36).substr(2,8).toUpperCase()})).join("-")}};var d=function(o,d){var l=31536e3,u=(new Date).getTime(),_=function(){},m=function(){},g=new Promise((function(e,t){_=t=>{setTimeout((()=>{e(t)}),1)},m=e=>{setTimeout((()=>{t(new Error(e))}),1)}}));if(console.log("[Sendsay Data Send]:",(new Date).toLocaleString()),e[s].debug&&console.log("PARAMS:",d),e[s].debug&&console.group("Sendsay"),e[s].debug&&console.log("Call %s:",o,d),e[s].debug&&console.log("Env before:",e[s]),"init"===o){if(e[s].debug&&console.groupCollapsed("Init"),e[s].fid=d.fid,e[s].dhost=d.dhost||"link.sendsay.ru",e[s].dataLayerWatch=d.dataLayerWatch||!1,e[s].dataLayerScheme=d.dataLayerScheme||"ym",e[s].debug&&console.log("Referrer:",t.referrer),t.referrer){var h=t.referrer.substr(t.referrer.indexOf("://")+3).split("?")[0].split("/"),p=[];h[3]&&(p=h[3].split(",")),e[s].debug&&console.log("Parse:",h),e[s].debug&&console.log("PLC:",p),h[3]&&h[1]&&p.length>3&&h[1]===e[s].fid&&(e[s].plc=h[3],e[s].host=h[0],r("_sndsy_fid",e[s].fid,l),r("_sndsy_host",e[s].host,l),0!=e[s].plc.indexOf("0,0,")?(e[s].debug&&console.log("[set] _sndsy_csdt: "+u),r("_sndsy_plc",e[s].plc,l),r("_sndsy_csdt",u,l)):(e[s].plc=void 0,delete e[s].plc),a("_sndsy_mid"),c.removeItem("mid"),e[s].debug&&console.log("[] Set cookie: ",document.cookie))}else if(n("_sndsy_fid")){e[s].debug&&console.log("[] Timeup cookie: ",document.cookie),r("_sndsy_fid",n("_sndsy_fid"),l),n("_sndsy_host")&&r("_sndsy_host",n("_sndsy_host"),l);var y=n("_sndsy_plc");y&&0!=y.indexOf("0,0,")&&r("_sndsy_plc",y,l)}let o=(i("sendsay_plc")||"").split(",");if(o.length>3&&o[0]===e[s].fid)r("_sndsy_plc",o.slice(1).join(","),l),r("_sndsy_csdt",u,l),e[s].plc=n("_sndsy_plc");else if(void 0===e[s].plc){var E=n("plc"),v=n("plc_dt");if(E){var S=E.split(",");S[0]===e[s].fid&&(r("_sndsy_plc",","+S.slice(1).join(","),l),r("_sndsy_csdt",v+"000",l),r("_sndsy_fid",S[0],l),e[s].plc=S.slice(1).join(","))}else n("_sndsy_fid")===e[s].fid&&(e[s].plc=n("_sndsy_plc"));e[s].debug&&console.log("Read cookie"),e[s].host=n("_sndsy_host")}e[s].debug&&console.groupEnd(),_({event:"init"})}else if("send"===o){e[s].debug&&console.groupCollapsed("Send");var A=("https:"==t.location.protocol?"https:":"http:")+"//";if(Array.isArray(d.dk)&&(d.dk=JSON.stringify(d.dk)),e[s].debug&&Array.isArray(d.ssec)&&(console.log("SSEC:"),console.dir(JSON.parse(JSON.stringify(d.ssec)))),Array.isArray(d.ssec)&&(d.ssec=JSON.stringify(d.ssec)),d.url=d.url||t.location.href,d.url&&"NONE"!=d.url){const e=new URL(d.url),t=new URLSearchParams(e.search);t.delete("sendsay_plc"),e.search=t.toString(),d.url=e.toString()}void 0!==e[s].plc&&e[s].plc&&(d.plc=e[s].fid+","+e[s].plc),d.umid=c.getUMID(),void 0!==d.email&&d.email&&(e[s].debug&&console.log("[SET UDS] mid:",d.email),void 0!==d.dontCacheEmail&&d.dontCacheEmail||c.setItem("mid",d.email));var D=d.email||c.getItem("mid");d.plc&&""==d.plc||!D||(d.email=D);var f=new XMLHttpRequest,C=A+e[s].dhost+"/"+e[s].fid+"/0/?"+function(e){var t=[];for(var s in e)t.push(encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t.join("&")}(d),R=n("_sndsy_csdt");e[s].debug&&console.log("[Check] _sndsy_csdt:",R),R&&u-(R=parseInt(R,10))>432e6&&(e[s].debug&&console.log("_sndsy_plc:",e[s].plc),C+="&ii=1"),e[s].debug&&console.log("Url: ",C),e[s].debug&&console.log("Params: ",d);try{f.open("GET",C,!0),f.send(),e[s].debug&&console.log("Sent")}catch(e){console.error("Sendsay tracking error. URL: "+C),m({key:"xhr_error"})}f.onload=function(t){e[s].debug&&console.log("[xhr] onload"),_(t)},f.onerror=function(t){e[s].debug&&console.log("[xhr] onerror:",C,d),m(t)},f.onabort=function(t){e[s].debug&&console.log("[xhr] onabort:",C,d),m(t)},e[s].debug&&console.groupEnd()}return e[s].debug&&console.log("Env after: ",e[s]),e[s].debug&&console.groupEnd(),g};for(var l in e.sndsy.q)d.apply(null,e.sndsy.q[l]);e.sndsy=d;var u={UDS:c,getQuery:function(e){return i(e)},copyObj:function(e,t){return JSON.parse(JSON.stringify(e))},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isU:function(e){return void 0===e},isD:function(e){return void 0!==e},toInt:function(e){return"number"==typeof e?e:parseInt(e,10)},validEmail:function(e){return/^(([^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,})$/iu.test(e)},isEmail:function(e){return/^(([^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,})$/iu.test(e)},validPhone:function(e){return/^(\s*)?(\+)?([- _():=+]?\d[- _():=+]?){10,14}(\s*)?$/.test(e)},isPhone:function(e){return/^(\s*)?(\+)?([- _():=+]?\d[- _():=+]?){10,14}(\s*)?$/.test(e)},isDateTime:function(e){return/^(19|20)\d\d-((0[1-9]|1[012])-(0[1-9]|[12]\d)|(0[13-9]|1[012])-30|(0[13578]|1[02])-31) ([0-1]\d|2[0-3])(:[0-5]\d){2}$/.test(e)},isUrl:function(e){return/^(http[s]*:\/\/.)[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)$/i.test(e)},isObject:function(e){return"object"==typeof e&&!Array.isArray(e)&&null!==e},typeOf:function(e){return{}.toString.call(e).match(/\s(\w+)/)[1].toLowerCase()},readCookie:n,setCookie:r,unsetCookie:a,getUMID:function(){return c.getUMID()},getEmail:function(){return c.getItem("mid")||void 0},setEmail:function(e){c.setItem("mid",e)},getMemberId:function(){let[e,t,s,i]=(sndsyApi.readCookie("_sndsy_plc")||"").split(",");return i},log:{styles:{base:["color: #fff","background-color: #444","padding: 2px 4px","border-radius: 2px"],error:["color: #eee","background-color: red"],success:["background-color: green"],warning:["background-color: #ba930a","color: black"]},msg:function(e,t){var s;t=t||"base",s=this.styles.base.join(";")+";",t&&"base"!=t&&(s+=this.styles[t].join(";")),Array.isArray(e)?e.forEach((function(e){"object"==typeof e?console.log(e):console.log(`%c${e}`,s)})):"object"==typeof e?console.log(e):console.log(`%c${e}`,s)},ok:function(e){this.msg(e,"success")},err:function(e){this.msg(e,"error")},warn:function(e){this.msg(e,"warning")},warnSSecValue:function(e,t,s,i){this.warn(["[ssecEvent:"+e+'] wrong value "'+t+'" ('+i+" is expected)"]),this.msg(s)}},isDevMode:!1,setDevMode:function(e){var t=!this.isD(e)||e;"undefined"!=typeof localStorage&&(localStorage[t?"setItem":"removeItem"]("SENDSAY_DEBUG",1),this.log.msg("SENDSAY_DEBUG is "+(t?"ON":"OFF"),t?"success":"error")),this.isDevMode=t},dateFormat:function(e){var t=e||new Date;this.isU(e)&&t.setHours(t.getHours()+3);var s=function(e){return parseInt(e,10)<10?"0"+e:e},i=t.getUTCFullYear(),n=t.getUTCMonth()+1,r=(e=t.getUTCDate(),t.getUTCHours()),a=t.getUTCMinutes(),o=t.getUTCSeconds();return i+"-"+s(n)+"-"+s(e)+" "+s(r)+":"+s(a)+":"+s(o)},addData:function(e,t){var s={dk:[[this.ADD_KEY||sndsyData.ADD_KEY,"merge",t]]};this.isDevMode&&console.log("Send: ",s),this.send("send",s)},SSEC_EVENTS_LIST:{ORDER:1,VIEW_PRODUCT:0,VIEW_CATEGORY:2,BASKET_ADD:3,BASKET_UPDATE:3,BASKET_CLEAR:4,SEARCH_PRODUCT:5,SUBSCRIBE_PRODUCT_PRICE:6,SUBSCRIBE_PRODUCT_ISA:7,FAVORITE:8,PREORDER:12,PRODUCT_ISA:13,PREORDER_PRODUCT_ISA:14,PRODUCT_PRICE_CHANGED:15,REGISTRATION:28,AUTHORIZATION:29},ssecCP_Set:function(e,t){return this.isDevMode&&this.log.msg(["[ssecCP_Set]",arguments]),e.forEach(((e,s)=>{let i=1;do{let n="cp"+i;this.isD(e[n])&&e[n]&&(t[s][n]=e[n]),i++}while(i<21)})),this.isDevMode&&this.log.msg(["ssec_data:",t]),t},ssecValidation:function(e,t,s){var i=this,n=!1;s=s||{};if(this.log.msg(["ssecValidation: "+e,t]),["SUBSCRIBE_PRODUCT_ISA","SUBSCRIBE_PRODUCT_PRICE","PRODUCT_ISA","VIEW_PRODUCT","PREORDER","FAVORITE","PRODUCT_PRICE_CHANGED"].includes(e))this.isDevMode&&console.log("[ssecValidation] PRODUCT TYPE"),this.isD(t.action)&&0==t.action?(this.isU(t.id)||""==t.id)&&(n=!0,this.log.err(["[ssecEvent:"+e+'] undefined "id" (String is expected)',t.id]),this.log.msg(t.id)):((this.isU(t.id)||""==t.id)&&(n=!0,this.log.err(["[ssecEvent:"+e+'] undefined "id" (String is expected)',t.id]),this.log.msg(t.id)),this.isD(t.available)&&![0,1].includes(t.available)&&this.log.warnSSecValue(e,"available",t.available,"1 or 0"),this.isD(t.old_price)&&!this.isNumeric(t.old_price)&&this.log.warnSSecValue(e,"old_price",t.old_price,"Number"),["model","description"].forEach((function(s){!i.isD(t[s])||"string"==typeof t[s]&&""!=t[s]||i.log.warnSSecValue(e,s,t[s],"String")})),!this.isU(t.price)&&this.isNumeric(t.price)||this.log.warnSSecValue(e,"price",t.price,"Number"),(i.isU(t.name)||"string"!=typeof t.name||""==t.name)&&i.log.warnSSecValue(e,"name",t.name,"String"),s.dataLayerWatchMode||((i.isU(t.vendor)||"string"!=typeof t.vendor||""==t.vendor)&&i.log.warnSSecValue(e,"vendor",t.vendor,"String"),!this.isU(t.picture)&&Array.isArray(t.picture)||this.log.warnSSecValue(e,"picture",t.picture,"Array<String>"),!this.isU(t.url)&&this.isUrl(t.url)||this.log.warnSSecValue(e,"url",t.url,"URL-string")));else if("SEARCH_PRODUCT"==e)this.isU(t.description)&&(n=!0,this.log.err(["[ssecEvent:"+e+'] wrong value "description" (String is expected)']),this.log.msg(t));else if("VIEW_CATEGORY"==e){let i=!0,n=!0;s.dataLayerWatchMode?i=!1:!this.isU(t.category_id)&&this.isNumeric(t.category_id)||(i=!1,this.log.warnSSecValue(e,"category_id",t.category_id,"Number")),!this.isD(t.category)||"string"==typeof t.category&&""!=t.category||(n=!1,this.log.warnSSecValue(e,"category",t.category,"String")),i||n||this.log.err(["[ssecEvent:"+e+'] unknown value "category_id" and "category" (One of the parameters is expected)']),this.isD(t.category_paths)&&!Array.isArray(t.category_paths)&&this.log.warnSSecValue(e,"category_paths",t.category_paths,"Array<string>")}else"BASKET_ADD"==e?(this.isU(t.items)||!Array.isArray(t.items)?(n=!0,this.log.err(["[ssecEvent:"+e+'] wrong value "items" (Array is expected)']),this.log.msg(t.items)):t.items.forEach((function(t){(i.isU(t.id)||""==t.id)&&(n=!0,i.log.err(["[ssecEvent:"+e+'] wrong value "item.id" (String is expected)']),i.log.msg(t.id)),(i.isU(t.qnt)||i.isD(t.qnt)&&!i.isNumeric(t.qnt))&&(n=!0,i.log.err(["[ssecEvent:"+e+'] wrong value "item.qnt" (Number is expected)']),i.log.msg(t.qnt)),(i.isU(t.price)||i.isD(t.price)&&!i.isNumeric(t.price))&&(n=!0,i.log.err(["[ssecEvent:"+e+'] wrong value "item.price" (Number is expected)']),i.log.msg(t.price)),(i.isU(t.name)||"string"!=typeof t.name||""==t.name)&&i.log.warnSSecValue(e,"name",t.name,"String"),!i.isD(t.vendor)||"string"==typeof t.vendor&&""!=t.vendor||i.log.warnSSecValue(e,"vendor",t.vendor,"String"),i.isD(t.picture)&&!Array.isArray(t.picture)&&i.log.warnSSecValue(e,"picture",t.picture,"Array<String>"),i.isD(t.url)&&!i.isUrl(t.url)&&i.log.warnSSecValue(e,"url",t.url,"URL-string")})),!this.isD(t.transaction_id)||""!=t.transaction_id&&"string"==typeof t.transaction_id||this.log.warnSSecValue(e,"transaction_id",t.transaction_id,"String"),this.isD(t.transaction_dt)&&!this.isDateTime(t.transaction_dt)&&this.log.warnSSecValue(e,"transaction_dt",t.transaction_dt,'Datetime string "YYYY-MM-DD hh:mm:ss"'),this.isD(t.update_per_item)&&!this.isNumeric(t.update_per_item)&&this.log.warnSSecValue(e,"update_per_item",t.update_per_item,"Number"),!this.isU(t.transaction_sum)&&this.isNumeric(t.transaction_sum)||this.log.warnSSecValue(e,"transaction_sum",t.transaction_sum,"Number")):"ORDER"==e&&((this.isU(t.transaction_id)||""==t.transaction_id)&&(n=!0,this.log.err(["[ssecEvent:"+e+'] undefined "transaction_id" (String is expected)']),this.log.msg(t.transaction_id)),!this.isU(t.transaction_dt)&&this.isDateTime(t.transaction_dt)||(n=!0,this.log.err(["[ssecEvent:"+e+'] wrong value "transaction_dt" (Datetime string "YYYY-MM-DD hh:mm:ss" is expected)']),this.log.msg(t.transaction_dt)),!this.isU(t.transaction_status)&&this.isNumeric(t.transaction_status)||(n=!0,this.log.err(["[ssecEvent:"+e+'] wrong value "transaction_status" (Number expected)']),this.log.msg(t.transaction_status)),!this.isU(t.transaction_sum)&&this.isNumeric(t.transaction_sum)||this.log.warnSSecValue(e,"transaction_sum",t.transaction_sum,"Number"),this.isD(t.update)&&1==t.update?this.isD(t.items)&&Array.isArray(t.items)&&0==t.items.length&&(n=!0,this.log.err(["[ssecEvent:"+e+"](update="+t.update+') wrong value "items" (Array[{id,qnt,price}] is expected)']),this.log.msg(t.data)):!this.isU(t.items)&&Array.isArray(t.items)&&0!=t.items.length||(n=!0,this.log.err(["[ssecEvent:"+e+"](update="+t.update+') wrong value "items" (Array[{id,qnt,price}] is expected)']),this.log.msg(t.data)),this.isD(t.items)&&Array.isArray(t.items)&&t.items.length&&t.items.forEach((function(t){(i.isU(t.id)||""==t.id)&&(n=!0,i.log.err(["[ssecEvent:"+e+'] wrong value "item.id" (String is expected)']),i.log.msg(t.id)),(i.isU(t.qnt)||i.isD(t.qnt)&&!i.isNumeric(t.qnt))&&(n=!0,i.log.err(["[ssecEvent:"+e+'] wrong value "item.qnt" (Number is expected)']),i.log.msg(t.qnt)),(i.isU(t.price)||i.isD(t.price)&&!i.isNumeric(t.price))&&(n=!0,i.log.err(["[ssecEvent:"+e+'] wrong value  "item.price" (Number is expected)']),i.log.msg(t.price))})),["payment_dt","delivery_dt"].forEach((function(s){i.isD(t[s])&&!i.isDateTime(t[s])&&i.log.warnSSecValue(e,s,t[s],'Datetime string "YYYY-MM-DD hh:mm:ss"')})));return!n},ssecEvent:function(e,t,s,i){var n={ORDER:"Order",VIEW_PRODUCT:"ViewProduct",VIEW_CATEGORY:"ViewCategory",BASKET_ADD:"BasketAdd",BASKET_UPDATE:"BasketUpdate",BASKET_CLEAR:"BasketClear",SEARCH_PRODUCT:"SearchProduct",SUBSCRIBE_PRODUCT_PRICE:"SubscribeProductPrice",SUBSCRIBE_PRODUCT_ISA:"SubscribeProductISA",PREORDER:"PreOrder",PRODUCT_ISA:"ProductISA",PREORDER_PRODUCT_ISA:"PreOrderProductISA",PRODUCT_PRICE_CHANGED:"ProductPriceChanged",REGISTRATION:"Registration",AUTHORIZATION:"Authorization"}[e]||!1;i=i||{};return"SUBSCRIBE_PRODUCT_ISA"==e?this.isD(t.add)?this.ssecEvent_SubscribeProductISA(t.add,s||void 0,i):this.isD(t.clear)?this.ssecEvent_ClearSubscribeProductISA(s||void 0,i):this.isD(t.delete)?this.ssecEvent_DeleteSubscribeProductISA(t.delete,s||void 0,i):this.isD(t)&&Array.isArray(t)?this.ssecEvent_SubscribeProductISA(t,s||void 0,i):console.warn('[sndsyApi] "'+e+'" wrong data'):"SUBSCRIBE_PRODUCT_PRICE"==e?this.isD(t.add)?this.ssecEvent_SubscribeProductPrice(t.add,s||void 0,i):this.isD(t.clear)?this.ssecEvent_ClearSubscribeProductPrice(s||void 0,i):this.isD(t.delete)?this.ssecEvent_DeleteSubscribeProductPrice(t.delete,s||void 0,i):this.isD(t)&&Array.isArray(t)?this.ssecEvent_SubscribeProductPrice(t,s||void 0,i):console.warn('[sndsyApi] "'+e+'" wrong data'):"FAVORITE"==e?this.isD(t.add)?this.ssecEvent_Favorite(t.add,s||void 0,i):this.isD(t.clear)?this.ssecEvent_ClearFavorite(s||void 0,i):this.isD(t.delete)?this.ssecEvent_DeleteFavorite(t.delete,s||void 0,i):this.isD(t)&&Array.isArray(t)?this.ssecEvent_Favorite(t,s||void 0,i):console.warn('[sndsyApi] "'+e+'" wrong data'):"PREORDER"==e?(this.isDevMode&&this.log.msg(["ssecEvent data:",t,s]),this.isD(t.add)?this.ssecEvent_PreOrder(t.add,s||void 0,i):this.isD(t.clear)?this.ssecEvent_ClearPreOrder(s||void 0,i):this.isD(t.delete)?this.ssecEvent_DeletePreOrder(t.delete,s||void 0,i):this.isD(t)&&Array.isArray(t)?this.ssecEvent_PreOrder(t,s||void 0,i):(console.warn('[sndsyApi] "'+e+'" wrong data'),o({key:"wrong_data"}))):(this.log.msg([e,n]),n&&"function"==typeof this["ssecEvent_"+n]?this["ssecEvent_"+n].call(this,t,s,i):(console.warn('[sndsyApi] "'+e+'" unknown'),o({key:"unknown_event_type"})))},_ssecEventLikePoduct:function(e,t,s){this.isDevMode&&this.log.msg(["[_ssecEventLikePoduct] call: ",arguments]);var i=this,n=t||{},r=t.event_type,a=this.isD(n.action)?n.action:1,c=!0,d={ssec:[],url:"NONE"};if(this.isD(e.dk)&&(d.dk=e.dk),Array.isArray(e)&&e.length?(e.forEach((function(e,t){"object"==typeof e?(e.event_type=i.SSEC_EVENTS_LIST[r],e.action=a,d.ssec.push(e)):i.isD(e)?d.ssec.push({id:e,event_type:i.SSEC_EVENTS_LIST[r],action:a}):console.warn("Event _ssecEvent["+r+"] ["+t+'] "id" undefined')})),d.ssec=this.ssecCP_Set(e,d.ssec)):i.isD(e)&&d.ssec.push({id:e,event_type:i.SSEC_EVENTS_LIST[r],action:a}),e.forEach((function(e,t){i.ssecValidation(r,e,s)||(c=!1)})),this.isD(n.extra)&&n.extra){for(var l in n.extra)d[l]=n.extra[l];if(n.extra&&n.extra.testing_mute)return this.log.msg(["[CALL] _ssecEvent["+r+"]",arguments,"Data:",d]),o({key:"testing_mute"})}return this.isDevMode&&this.log.msg(["[_ssecEventLikePoduct] _send_data: ",d]),this.isD(n.email)&&n.email&&""!=n.email&&(d.email=n.email),c&&d.ssec.length?(this.isDevMode&&this.log.ok(["[_ssecEvent]["+r+"] Send: ",d]),this.send("send",d)):o({key:"wrong_data"})},ssecEvent_ViewProduct:function(e,t,s){var i=Object.assign(t||{},{event_type:"VIEW_PRODUCT"});return this._ssecEventLikePoduct(e,i,s)},ssecEvent_PreOrder:function(e,t,s){var i=Object.assign(t||{},{event_type:"PREORDER",action:1});return this._ssecEventLikePoduct(e,i,s)},_ssecEvent_DeletePreOrder:function(e,t,s){!this.isU(data_id)&&this.isNumeric(data_id)||(this.log.err(["[ssecEvent:PREORDER/DELETE] wrong value id (Number is expected)"]),this.log.msg(l.price),_is_verified=!1);var i=Object.assign(t||{},{event_type:"PREORDER",action:0});return this._ssecEventLikePoduct(data,i,s)},ssecEvent_DeletePreOrder:function(e,t,s){var i=this,n=t||{},r=!0,a={ssec:[],url:"NONE"};if(Array.isArray(e)?e.forEach((function(t){i.isNumeric(t)||(i.log.err(['[ssecEvent_DeletePreOrder] wrong value "id" (Number is expected)']),i.log.msg(e),r=!1),a.ssec.push({event_type:i.SSEC_EVENTS_LIST.PREORDER,id:t,action:0})})):(!this.isU(e)&&this.isNumeric(e)||(this.log.err(['[ssecEvent_DeletePreOrder] wrong value "id" (Number is expected)']),this.log.msg(e),r=!1),a.ssec.push({event_type:this.SSEC_EVENTS_LIST.PREORDER,id:e,action:0})),this.isD(n.extra)&&n.extra){for(var c in n.extra)a[c]=n.extra[c];if(n.extra&&n.extra.testing_mute)return this.log.msg(["[CALL] ssecEvent_DeletePreOrder",arguments,"Data:",a]),o({key:"testing_mute"})}return r?(this.isD(n.dontCacheEmail)&&n.dontCacheEmail&&(a.dontCacheEmail=!0),this.isD(n.email)&&n.email&&""!=n.email&&(a.email=n.email),this.isDevMode&&console.log("[ssecEvent_DeletePreOrder] Send: ",a),this.send("send",a)):o({key:"wrong_data"})},ssecEvent_ClearPreOrder:function(e,t){var s=e||{},i={ssec:[{event_type:this.SSEC_EVENTS_LIST.PREORDER,action:0}],url:"NONE"};if(this.isD(s.extra)&&s.extra){for(var n in s.extra)i[n]=s.extra[n];if(s.extra&&s.extra.testing_mute)return this.log.msg(["[CALL] ssecEvent_ClearPreOrder",arguments,"Data:",i]),o({key:"testing_mute"})}return this.isD(s.dontCacheEmail)&&s.dontCacheEmail&&(i.dontCacheEmail=!0),this.isD(s.email)&&s.email&&""!=s.email&&(i.email=s.email),this.isDevMode&&console.log("[ssecEvent_ClearPreOrder] Send: ",i),this.send("send",i)},ssecEvent_ProductISA:function(e,t,s){var i=Object.assign(t||{},{event_type:"PRODUCT_ISA"});return this._ssecEventLikePoduct(e,i)},ssecEvent_Order:function(e,t,s){var i=this,n=Array.isArray(e)?e[0]:this.copyObj(e),r=t||{},a=!0,c={ssec:[{event_type:this.SSEC_EVENTS_LIST.ORDER}],url:"NONE"};if(Array.isArray(e)||this.log.warn("[ssecEvent_Order] Move to array data"),this.isDevMode&&console.log("_data:",n),this.ssecValidation("ORDER",n)||(a=!1),this.isU(n.transaction_id)||!n.transaction_id?(a=!1,console.warn('ssecEvent_Order "transaction_id" undefined')):c.ssec[0].transaction_id=n.transaction_id,this.isU(n.transaction_dt)||!this.isDateTime(n.transaction_dt)?(a=!1,console.warn('ssecEvent_Order "transaction_dt" wrong or undefined')):c.ssec[0].transaction_dt=n.transaction_dt,["payment_dt","delivery_dt","delivery_price","update","transaction_dt","transaction_sum","transaction_status","transaction_discount"].forEach((function(e){i.isD(n[e])&&n[e]&&(c.ssec[0][e]=n[e])})),this.isD(n.items)&&Array.isArray(n.items)&&(0==n.items.length?c.ssec[0].items=[]:n.items.forEach((function(e){i.isD(e.id)&&i.isD(e.qnt)&&i.isD(e.price)&&(c.ssec[0].items?c.ssec[0].items.push(e):c.ssec[0].items=[e])})),c.ssec=this.ssecCP_Set(e,c.ssec)),this.isD(r.extra)&&r.extra){for(var d in r.extra)c[d]=r.extra[d];if(r.extra&&r.testing_mute)return this.isDevMode&&this.log.msg(["[CALL] ssecEvent_Order",arguments,"Data:",c]),o({key:"testing_mute"})}return this.isD(r.dontCacheEmail)&&r.dontCacheEmail&&(c.dontCacheEmail=!0),this.isD(r.email)&&r.email&&""!=r.email&&(c.email=r.email),a?(this.isDevMode&&this.log.ok(["[ssecEvent][ORDER] Send: ",c]),this.send("send",c)):o({key:"wrong_data"})},ssecEvent_ViewCategory:function(e,t,s){var i=this,n=!0,r=t||{},a={ssec:[],url:"NONE"};if(e.forEach((function(e,t){i.ssecValidation("VIEW_CATEGORY",e,s)?(e.event_type=i.SSEC_EVENTS_LIST.VIEW_CATEGORY,a.ssec.push(e)):n=!1})),a.ssec=this.ssecCP_Set(e,a.ssec),this.isD(r.extra)&&r.extra){for(var c in r.extra)a[c]=r.extra[c];if(r.extra&&r.testing_mute)return this.isDevMode&&this.log.msg(["[CALL] ssecEvent_ViewCategory",arguments,"Data:",a]),o({key:"testing_mute"})}return this.isD(r.dontCacheEmail)&&r.dontCacheEmail&&(a.dontCacheEmail=!0),this.isD(r.email)&&r.email&&""!=r.email&&(a.email=r.email),n?(this.isDevMode&&this.log.ok(["[ssecEvent][VIEW_CATEGORY] Send: ",a]),this.send("send",a)):o({key:"wrong_data"})},ssecEvent_BasketUpdate:function(){return this.ssecEvent_BasketAdd.apply(this,arguments)},ssecEvent_BasketAdd:function(e,t,s){var i=Array.isArray(e)?e[0]:e,n=this,r=!0,a=t||{},c={ssec:[{event_type:n.SSEC_EVENTS_LIST.BASKET_ADD}],url:"NONE"};if(!this.ssecValidation("BASKET_ADD",i))return r=!1,o({key:"wrong_data"});if(Array.isArray(e)||console.warn("[ssecEvent_BasketAdd] Move to array data"),c.ssec=this.ssecCP_Set(e,c.ssec),["transaction_id","transaction_dt","transaction_sum"].forEach((function(e){n.isD(i[e])&&i[e]&&(c.ssec[0][e]=i[e])})),this.isD(i.update_per_item)&&(c.ssec[0].update_per_item=i.update_per_item),this.isDevMode&&this.log.msg(["[CALL] ssecEvent_BasketAdd data:",i]),this.isD(i.items)&&Array.isArray(i.items)&&(0==i.items.length?c.ssec[0].items=[]:i.items.forEach((function(e){n.isD(e.id)&&n.isD(e.qnt)&&n.isD(e.price)&&(c.ssec[0].items?c.ssec[0].items.push(e):c.ssec[0].items=[e])}))),this.isDevMode&&this.log.ok("_is_verified: "+r),this.isD(a.extra)&&a.extra){for(var d in a.extra)c[d]=a.extra[d];if(a.extra&&this.isD(a.testing_mute)&&a.testing_mute)return this.log.msg(["[CALL] ssecEvent_BasketAdd",arguments,"Data:",c]),o({key:"testing_mute"})}return this.isD(a.dontCacheEmail)&&a.dontCacheEmail&&(c.dontCacheEmail=!0),this.isD(a.email)&&a.email&&""!=a.email&&(c.email=a.email),r?(this.isDevMode&&this.log.ok(["[ssecEvent][BASKET_ADD] Send: ",c]),this.send("send",c)):o({key:"wrong_data"})},ssecEvent_BasketClear:function(e,t){var s=e||{},i={ssec:[{items:[{id:"-1"}],event_type:this.SSEC_EVENTS_LIST.BASKET_CLEAR}],url:"NONE"};if(this.isD(s.extra)&&s.extra){for(var n in s.extra)i[n]=s.extra[n];if(s.extra&&s.testing_mute)return this.log.msg(["[CALL] ssecEvent_BasketClear",arguments,"Data:",i]),o({key:"testing_mute"})}return this.isD(s.dontCacheEmail)&&s.dontCacheEmail&&(i.dontCacheEmail=!0),this.isD(s.email)&&s.email&&""!=s.email&&(i.email=s.email),this.isDevMode&&this.log.ok(["[ssecEvent][BASKET_CLEAR] Send: ",i]),this.send("send",i)},ssecEvent_SearchProduct:function(e,t,s){var i=Object.assign(t||{},{event_type:"SEARCH_PRODUCT"});return this._ssecEventLikePoduct(e,i,s)},ssecEvent_SubscribeProductPrice:function(e,t,s){var i=Object.assign(t||{},{event_type:"SUBSCRIBE_PRODUCT_PRICE",action:1});return this._ssecEventLikePoduct(e,i,s)},ssecEvent_ProductPriceChanged:function(e,t,s){var i=this,n=t||{},r=!0,a={ssec:[],url:"NONE"};if(e.forEach((function(e){(i.isU(e.id)||""==e.id)&&(i.log.err(['[ssecEvent_ProductPriceChanged] wrong value "id" (String is expected)']),i.log.msg(e.id),r=!1),i.isNumeric(e.old_price)||(i.log.err(['[ssecEvent_ProductPriceChanged] wrong value "old_price" (Number is expected)']),i.log.msg(e.old_price),r=!1),i.isNumeric(e.price)||(i.log.err(['[ssecEvent_ProductPriceChanged] wrong value "price" (Number is expected)']),i.log.msg(e.price),r=!1),a.ssec.push(Object.assign({},e,{event_type:i.SSEC_EVENTS_LIST.PRODUCT_PRICE_CHANGED}))})),a.ssec=this.ssecCP_Set(e,a.ssec),this.isD(n.extra)&&n.extra){for(var c in n.extra)a[c]=n.extra[c];if(n.extra&&n.extra.testing_mute)return this.log.msg(["[CALL] ssecEvent_ProductPriceChanged",arguments,"Data:",a]),o({key:"testing_mute"})}return r?(this.isD(n.dontCacheEmail)&&n.dontCacheEmail&&(a.dontCacheEmail=!0),this.isD(n.email)&&n.email&&""!=n.email&&(a.email=n.email),this.isDevMode&&console.log("[ssecEvent_ProductPriceChanged] Send: ",a),this.send("send",a)):o({key:"wrong_data"})},ssecEvent_DeleteSubscribeProductPrice:function(e,t,s){var i=this,n=t||{},r=!0,a={ssec:[],url:"NONE"};if(this.isDevMode&&this.log.msg(["[CALL] ssecEvent_DeleteSubscribeProductPrice:",arguments]),Array.isArray(e)?e.forEach((function(t){i.isNumeric(t)||(i.log.err(['[ssecEvent_DeleteSubscribeProductPrice] wrong value "id" (Number is expected)']),i.log.msg(e),r=!1),a.ssec.push({event_type:i.SSEC_EVENTS_LIST.SUBSCRIBE_PRODUCT_PRICE,id:t,action:0})})):(!this.isU(e)&&this.isNumeric(e)||(this.log.err(['[ssecEvent_DeleteSubscribeProductPrice] wrong value "id" (Number is expected)']),this.log.msg(e),r=!1),a.ssec.push({event_type:this.SSEC_EVENTS_LIST.SUBSCRIBE_PRODUCT_PRICE,id:e,action:0})),this.isD(n.extra)&&n.extra){for(var c in n.extra)a[c]=n.extra[c];if(n.extra&&n.extra.testing_mute)return this.log.msg(["[CALL] ssecEvent_DeleteSubscribeProductPrice",arguments,"Data:",a]),o({key:"testing_mute"})}return r?(this.isD(n.dontCacheEmail)&&n.dontCacheEmail&&(a.dontCacheEmail=!0),this.isD(n.email)&&n.email&&""!=n.email&&(a.email=n.email),this.isDevMode&&console.log("[ssecEvent_DeleteSubscribeProductPrice] Send: ",a),this.send("send",a)):o({key:"wrong_data"})},ssecEvent_ClearSubscribeProductPrice:function(e,t){var s=e||{},i={ssec:[{event_type:this.SSEC_EVENTS_LIST.SUBSCRIBE_PRODUCT_PRICE,action:0}],url:"NONE"};if(this.isD(s.extra)&&s.extra){for(var n in s.extra)i[n]=s.extra[n];if(s.extra&&s.extra.testing_mute)return this.log.msg(["[CALL] ssecEvent_ClearSubscribeProductPrice",arguments,"Data:",i]),o({key:"testing_mute"})}return this.isD(s.dontCacheEmail)&&s.dontCacheEmail&&(i.dontCacheEmail=!0),this.isD(s.email)&&s.email&&""!=s.email&&(i.email=s.email),this.isDevMode&&console.log("[ssecEvent][SUBSCRIBE_PRODUCT_PRICE] Send: ",i),this.send("send",i)},ssecEvent_SubscribeProductISA:function(e,t,s){var i=Object.assign(t||{},{event_type:"SUBSCRIBE_PRODUCT_ISA",action:1});return this._ssecEventLikePoduct(e,i,s)},ssecEvent_DeleteSubscribeProductISA:function(e,t,s){var i=this,n=t||{},r=!0,a={ssec:[],url:"NONE"};if(Array.isArray(e)?e.forEach((function(t){i.isNumeric(t)||(i.log.err(['[ssecEvent_DeleteSubscribeProductISA] wrong value "id" (Number is expected)']),i.log.msg(e),r=!1),a.ssec.push({event_type:i.SSEC_EVENTS_LIST.SUBSCRIBE_PRODUCT_ISA,id:t,action:0})})):(!this.isU(e)&&this.isNumeric(e)||(this.log.err(['[ssecEvent_DeleteSubscribeProductISA] wrong value "id" (Number is expected)']),this.log.msg(e),r=!1),a.ssec.push({event_type:this.SSEC_EVENTS_LIST.SUBSCRIBE_PRODUCT_ISA,id:e,action:0})),this.isD(n.extra)&&n.extra){for(var c in n.extra)a[c]=n.extra[c];if(n.extra&&n.extra.testing_mute)return this.log.msg(["[CALL] ssecEvent_DeleteSubscribeProductISA",arguments,"Data:",a]),o({key:"testing_mute"})}return r?(this.isD(n.dontCacheEmail)&&n.dontCacheEmail&&(a.dontCacheEmail=!0),this.isD(n.email)&&n.email&&""!=n.email&&(a.email=n.email),this.isDevMode&&console.log("[ssecEvent_DeleteSubscribeProductISA] Send: ",a),this.send("send",a)):o({key:"wrong_data"})},ssecEvent_ClearSubscribeProductISA:function(e,t){var s=e||{},i={ssec:[{event_type:this.SSEC_EVENTS_LIST.SUBSCRIBE_PRODUCT_ISA,action:0}],url:"NONE"};if(this.isD(s.extra)&&s.extra){for(var n in s.extra)i[n]=s.extra[n];if(s.extra&&s.extra.testing_mute)return this.log.warn(["[CALL] ssecEvent_ClearSubscribeProduct",arguments,"Data:",i]),o({key:"testing_mute"})}return this.isD(s.dontCacheEmail)&&s.dontCacheEmail&&(i.dontCacheEmail=!0),this.isD(s.email)&&s.email&&""!=s.email&&(i.email=s.email),this.isDevMode&&console.log("[ssecEvent][SUBSCRIBE_PRODUCT_ISA] Send: ",i),this.send("send",i)},ssecEvent_Favorite:function(e,t,s){var i=Object.assign(t||{},{event_type:"FAVORITE",action:1});return this._ssecEventLikePoduct(e,i,s)},ssecEvent_DeleteFavorite:function(e,t,s){var i=this,n=t||{},r=!0,a={ssec:[],url:"NONE"};if(Array.isArray(e)?(e.length||(i.log.err(['[ssecEvent_DeleteFavorite] wrong value "id" ([]String is expected)']),i.log.msg(e),r=!1),e.forEach((function(t){t||(i.log.err(['[ssecEvent_DeleteFavorite] wrong value "id" (String is expected)']),i.log.msg(e),r=!1),a.ssec.push({event_type:i.SSEC_EVENTS_LIST.FAVORITE,id:t,action:0})}))):(!this.isU(e)&&e||(this.log.err(['[ssecEvent_DeleteFavorite] wrong value "id" (String is expected)']),this.log.msg(e),r=!1),a.ssec.push({event_type:this.SSEC_EVENTS_LIST.FAVORITE,id:e,action:0})),this.isD(n.extra)&&n.extra){for(var c in n.extra)a[c]=n.extra[c];if(n.extra&&n.extra.testing_mute)return this.log.msg(["[CALL] ssecEvent_DeleteFavorite",arguments,"Data:",a]),o({key:"testing_mute"})}return r?(this.isD(n.dontCacheEmail)&&n.dontCacheEmail&&(a.dontCacheEmail=!0),this.isD(n.email)&&n.email&&""!=n.email&&(a.email=n.email),this.isDevMode&&console.log("[ssecEvent_DeleteFavorite] Send: ",a),this.send("send",a)):o({key:"wrong_data"})},ssecEvent_ClearFavorite:function(e,t){var s=e||{},i={ssec:[{event_type:this.SSEC_EVENTS_LIST.FAVORITE,action:0}],url:"NONE"};if(this.isD(s.extra)&&s.extra){for(var n in s.extra)i[n]=s.extra[n];if(s.extra&&s.extra.testing_mute)return this.log.warn(["[CALL] ssecEvent_ClearFavorite",arguments,"Data:",i]),o({key:"testing_mute"})}return this.isD(s.dontCacheEmail)&&s.dontCacheEmail&&(i.dontCacheEmail=!0),this.isD(s.email)&&s.email&&""!=s.email&&(i.email=s.email),this.isDevMode&&this.log.ok(["[ssecEvent][FAVORITE] CLEAR Send: ",i]),this.send("send",i)},ssecEvent_Registration:function(e,t){var s=e||{},i={ssec:[{event_type:this.SSEC_EVENTS_LIST.REGISTRATION}],url:"NONE"};if(this.isD(s.extra)&&s.extra){for(var n in s.extra)i[n]=s.extra[n];if(s.extra&&s.extra.testing_mute)return this.log.warn(["[CALL] ssecEvent_Registration",arguments,"Data:",i]),o({key:"testing_mute"})}return this.isD(s.dontCacheEmail)&&s.dontCacheEmail&&(i.dontCacheEmail=!0),this.isD(s.email)&&s.email&&""!=s.email&&(i.email=s.email),this.isD(s.dk)&&s.dk&&(i.dk=s.dk),this.isDevMode&&this.log.ok(["[ssecEvent][REGISTRATION] Send: ",i]),this.send("send",i)},ssecEvent_Authorization:function(e,t){var s=e||{},i={ssec:[{event_type:this.SSEC_EVENTS_LIST.AUTHORIZATION}],url:"NONE"};if(this.isD(s.extra)&&s.extra){for(var n in s.extra)i[n]=s.extra[n];if(s.extra&&s.extra.testing_mute)return this.log.warn(["[CALL] ssecEvent_Authorization",arguments,"Data:",i]),o({key:"testing_mute"})}return this.isD(s.dontCacheEmail)&&s.dontCacheEmail&&(i.dontCacheEmail=!0),this.isD(s.email)&&s.email&&""!=s.email&&(i.email=s.email),this.isDevMode&&this.log.ok(["[ssecEvent][AUTHORIZATION] Send: ",i]),this.send("send",i)},TravelLineCatch:function(e,t,s){this.isDevMode&&console.log("[sndsyApi] TravelLineCatch:",arguments);let i=this.TravelLineCallback(e,s||function(){});"function"==typeof i?i(t):console.warn("[sndsyApi.TravelLineCatch] что-то пошло не так =/")},TravelLineCallback:function(e,t){let s=this;return"onBookingSuccess"==e?function(e){let s=[],i=e.customerEmail||"",n={};i&&(sndsyApi.setEmail(i),n.email=i),e.roomTypes&&e.roomTypes.length&&(s=e.roomTypes.map((e=>({id:e.id,name:e.name,price:e.price,qnt:1,description:e.rateName})))),this.isDevMode&&console.log("onBookingSuccess",s),s.length?sndsyApi.ssecEvent("ORDER",[{transaction_id:e.bookingNumber,transaction_sum:e.price,transaction_status:1,transaction_dt:sndsyApi.dateFormat(),items:s}],n).then((()=>{"function"==typeof t&&t.apply(window,[e])})):"function"==typeof t&&t.apply(window,[e])}:"onBookingStepChanged"==e?function(e){"search"==e.step?sndsyApi.ssecEvent("VIEW_CATEGORY",[{category:"search",category_id:0}]).then((()=>{"function"==typeof t&&t.apply(window,[e])})):"preview"==e.step?sndsyApi.ssecEvent("VIEW_PRODUCT",[{id:"product1"}]).then((()=>{"function"==typeof t&&t.apply(window,[e])})):"payment"==e.step?sndsyApi.ssecEvent("BASKET_ADD",[{items:[{id:"product1",qnt:1,price:0}]}]).then((()=>{"function"==typeof t&&t.apply(window,[e])})):("complete"==e.step||sndsyApi.log.warn(["[TravelLineCallback] unknown step",e]),"function"==typeof t&&t.apply(window,[e]))}:function(i){s.log.warn(["[sndsyApi.TravelLineCallback] unknown event: "+e]),"function"==typeof t&&t.apply(window,[i])}},setData:function(e,t){if(this.isDevMode&&console.log("sndsyApi:setData ...",e),e){var s=window,i=t||{},n={dk:[[this.SET_KEY||(this.isD(s.sndsyData)&&s.sndsyData.SET_KEY?s.sndsyData.SET_KEY:void 0),"set",e]],ssec:e,is_basket:1,url:"NONE"};for(var r in i)n[r]=i[r];return this.isDevMode&&this.log.ok(["Send: ",n]),this.send("send",n)}},send:function(e,t){window;return""==location.host?this.log("action: "+e,"data:",t):(this.isDevMode&&this.log.ok(["sndsyApi -> send()",arguments]),d(e,t))},dkSend:function(e){var t={is_basket:0,url:"NONE"},s=this,i={dk:[[e.key,e.action,e.options]]};if(e.options)for(var n in e.options)i[n]=e.options[n];return Object.keys(t).forEach((function(e){s.isU(i[e])&&(i[e]=t[e])})),this.isDevMode&&this.log.ok("dkSend: ",i),this.send("send",i)},basketUpdate:function(e,t,s){this.isDevMode&&console.log("Call sndsyApi.basketUpdate ...");s=s||{};var i={datetime:sndsyApi.dateFormat(),id:s.id||"",items:{},summ:0,payment_datetime:s.payment_datetime||""};for(var n in e){var r=e[n];for(var a in i.items[r.id]={},e[n]){var o=a;"qty"!=a&&"quantity"!=a||(o="count"),i.items[r.id][o]=e[n][a]}this.isU(i.items[r.id].price)||this.isU(i.items[r.id].count)||(i.summ+=this.toInt(i.items[r.id].price)*this.toInt(i.items[r.id].count))}return sndsyApi.setData(i,t||{})},basketClear:function(e){this.isDevMode&&console.log("Call sndsyApi.basketClear ...");var t=Object.assign(e||{},{ssec:[{items:[{id:"-1"}],event_type:this.SSEC_EVENTS_LIST.BASKET_CLEAR}],url:"NONE"});return this.basketUpdate({},t||{})},runQueue:function(){this.isDevMode&&console.log("[runQueue] sndsyApiOnReady:",window.sndsyApiOnReady),void 0!==window.sndsyApiOnReady&&Array.isArray(window.sndsyApiOnReady)&&(this.isDevMode&&console.log("CALL from sndsyApiOnReady:"),this.isDevMode&&console.log(window.sndsyApiOnReady),window.sndsyApiOnReady.forEach((function(e){e.apply(window,[])})),this.isDevMode&&console.log("CLEAR sndsyApiOnReady:"),window.sndsyApiOnReady=[])},rq:function(){this.runQueue()}};for(var _ in e.sndsyApi=e.sndsyApi||{},u)e.sndsyApi[_]=e.sndsyApi[_]||u[_];try{var m=localStorage.getItem("SENDSAY_DEBUG");void 0!==m&&m&&(e.sndsyApi.log.ok("SENDSAY_DEBUG is ON"),e.sndsyApi.isDevMode=!0)}catch(e){}if(e.sndsyApi.runQueue(),e[s].dataLayerWatch){let i,n=e[s].dataLayerWatch;if("string"==typeof n){if(!Array.isArray(e[n]))return u.log.err(["[dataLayerWatcher] wrong key for watching",n]);i=e[n]}else{if("boolean"!=typeof n)return u.log.err(["[dataLayerWatcher] wrong dataLayerWatcher value",n]);if(void 0===e.dataLayer)return u.log.err(["[dataLayerWatcher] dataLayer is undefined"]);i=e.dataLayer}let r=function(e){let t=[];if(sndsyApi.isD(e.impressions)&&Array.isArray(e.impressions)){let s=!1;if(e.impressions.forEach((e=>{"string"!=typeof e.category||""==e.category?(s=!0,sndsyApi.log.err(['[ssecEvent:dataLayer -> VIEW_CATEGORY] unknown value "category" (String is expected)',e])):t.push({category:e.category})})),s)return;sndsyApi.ssecEvent("VIEW_CATEGORY",t,{},{dataLayerWatchMode:!0})}if(sndsyApi.isD(e.detail)){let s=!1;if(Array.isArray(e.detail.products)||(sndsyApi.log.err(["[ssecEvent:dataLayer(YM) -> VIEW_PRODUCT] wrong products (Array is expected)"]),sndsyApi.log.msg(e.detail)),e.detail.products.forEach((e=>{sndsyApi.isU(sndsyApi.isD(e.id))||""==e.id?(s=!0,sndsyApi.log.err(['[ssecEvent:dataLayer(YM) -> VIEW_PRODUCT] undefined "id" (String is expected)',e.id])):t.push({id:e.id,name:e.name||void 0,price:e.price||void 0,description:e.brand||void 0,category:e.category||void 0}),(sndsyApi.isU(e.name)||"string"!=typeof e.name||""==e.name)&&sndsyApi.log.warnSSecValue("dataLayer(YM) -> VIEW_PRODUCT","name",e.name,"String"),!sndsyApi.isU(e.price)&&sndsyApi.isNumeric(e.price)||sndsyApi.log.warnSSecValue("dataLayer(YM) -> VIEW_PRODUCT","price",e.price,"Number")})),s)return;sndsyApi.ssecEvent("VIEW_PRODUCT",t,{},{dataLayerWatchMode:!0})}let s=function(e,t){let s=!1,i=t.event,n=t.remove||!1;return(sndsyApi.isU(e.id)||""==e.id)&&(s=!0,sndsyApi.log.err(["[ssecEvent:dataLayer(YM) -> "+i+'] wrong value "id" (String is expected)']),sndsyApi.log.msg(e)),n||((sndsyApi.isU(e.quantity)||sndsyApi.isD(e.quantity)&&!sndsyApi.isNumeric(e.quantity))&&(s=!0,sndsyApi.log.err(["[ssecEvent:dataLayer(YM) -> "+i+'] wrong value "quantity" (Number is expected)']),sndsyApi.log.msg(_d)),(sndsyApi.isU(e.price)||sndsyApi.isD(e.price)&&!sndsyApi.isNumeric(e.price))&&(s=!0,sndsyApi.log.err(["[ssecEvent:dataLayer(YM) -> "+i+'] wrong value "price" (Number is expected)']),sndsyApi.log.msg(e))),(sndsyApi.isU(e.name)||"string"!=typeof e.name||""==e.name)&&sndsyApi.log.warnSSecValue("dataLayer(YM) -> "+i,"name",e.name,"String"),!s};if(sndsyApi.isD(e.add)){let i=!1;if(Array.isArray(e.add.products)||(sndsyApi.log.err(["[ssecEvent:dataLayer(YM) -> BASKET_ADD] wrong products (Array is expected)"]),sndsyApi.log.msg(e.add)),e.add.products.forEach((e=>{s(e,{event:"BASKET_ADD"})?t.push({update_per_item:1,items:[{id:e.id,name:e.name||void 0,price:e.price,qnt:e.quantity,description:e.brand||void 0,category:e.category||void 0}]}):i=!0})),i)return;sndsyApi.ssecEvent("BASKET_ADD",t,{},{dataLayerWatchMode:!0})}if(sndsyApi.isD(e.remove)){let i=!1;if(_items=[],Array.isArray(e.remove.products)||(sndsyApi.log.err(["[ssecEvent:dataLayer(YM) -> BASKET_ADD] wrong products (Array is expected)"]),sndsyApi.log.msg(e.remove)),e.remove.products.forEach((e=>{s(e,{event:"BASKET_ADD",remove:!0})?_items.push({id:e.id,name:e.name||void 0,price:0,description:e.brand||void 0,qnt:0,category:e.category||void 0}):i=!0})),i)return;_items.length&&t.push({transaction_sum:0,update_per_item:1,items:_items}),sndsyApi.ssecEvent("BASKET_ADD",t,{},{dataLayerWatchMode:!0})}if(sndsyApi.isD(e.checkout)){let i=e.checkout,n=!1;if(!sndsyApi.isU(i.products)&&Array.isArray(i.products)||(n=!0,sndsyApi.log.err(['[ssecEvent:dataLayer(YM) -> BASKET_ADD] undefined or wrong "products" (Array is expected)']),sndsyApi.log.msg(i)),!n){let e=0,r=i.products.reduce((function(t,i){return n||(s(i,{event:"BASKET_ADD"})?(e+=parseInt(i.quantity,10)*parseInt(i.price,10),t.push({id:i.id,name:i.name||void 0,price:i.price,qnt:i.quantity,description:i.brand||void 0,category:i.category||void 0})):n=!0),t}),[]);n||(t.push({transaction_sum:e,items:r}),sndsyApi.ssecEvent("BASKET_ADD",t,{},{dataLayerWatchMode:!0}))}}if(sndsyApi.isD(e.purchase)){let i=e.purchase,n=!1;if((sndsyApi.isU(i.actionField)||sndsyApi.isU(i.actionField.id)||""==i.actionField.id)&&(n=!0,sndsyApi.log.err(['[ssecEvent:dataLayer(YM) -> ORDER] undefined "actionField.id" (String is expected)']),sndsyApi.log.msg(i)),!sndsyApi.isU(i.products)&&Array.isArray(i.products)||(n=!0,sndsyApi.log.err(['[ssecEvent:dataLayer(YM) -> ORDER] undefined or wrong "products" (Array is expected)']),sndsyApi.log.msg(i)),!n){let e=0,r=i.products.reduce((function(t,i){return n||(s(i,{event:"ORDER"})?(e+=parseInt(i.quantity,10)*parseInt(i.price,10),t.push({id:i.id,name:i.name||void 0,price:i.price,qnt:i.quantity,description:i.brand||void 0,category:i.category||void 0})):n=!0),t}),[]);n||(t.push({transaction_id:i.actionField.id,transaction_sum:e,transaction_status:1,transaction_dt:sndsyApi.dateFormat(),items:r}),sndsyApi.ssecEvent("ORDER",t,{},{dataLayerWatchMode:!0}))}}},a=function(e,s,i){sndsyApi.isDevMode&&sndsyApi.log.warn(["[CALL] ga4_catch():",{action:e,event:s,data:i}]);let n={add_to_wishlist:"FAVORITE",view_item_list:"VIEW_CATEGORY",view_item:"VIEW_PRODUCT",add_to_cart:"BASKET_ADD",remove_from_cart:"BASKET_ADD",purchase:"ORDER"},r=[],a=!1,o="ssecEvent:dataLayer(GA4)",c=function(e,s){let i=!1,n=s.event,r=s.remove||!1;return(sndsyApi.isU(e.item_id)||""==e.item_id)&&(i=!0,sndsyApi.log.err(["["+o+" -> "+n+'] wrong value "item_id" (String is expected)',e])),0==r&&((sndsyApi.isU(e.quantity)||sndsyApi.isD(e.quantity)&&!sndsyApi.isNumeric(e.quantity))&&(i=!0,sndsyApi.log.err(["["+o+"  -> "+n+'] wrong value "quantity" (Number is expected)',e])),(sndsyApi.isU(e.price)||sndsyApi.isD(e.price)&&!sndsyApi.isNumeric(e.price))&&(i=!0,sndsyApi.log.err(["["+o+"  -> "+n+'] wrong value "price" (Number is expected)',e]))),(sndsyApi.isU(e.item_name)||"string"!=typeof e.item_name||""==e.item_name)&&sndsyApi.log.warnSSecValue(o+" -> "+n,"item_name",t.item_name,"String"),!i};if(["view_item_list","view_item","add_to_cart","remove_from_cart","purchase","add_to_wishlist"].includes(s)){if(!Array.isArray(i.items))return sndsyApi.log.err(["["+o+" -> "+n[s]+'] wrong "items" (Array is expected)']),void sndsyApi.log.msg(i);if(["view_item","add_to_wishlist"].includes(s)){i.items.forEach((e=>{sndsyApi.isU(sndsyApi.isD(e.item_id))||"string"!=typeof e.item_id||""==e.item_id?(a=!0,sndsyApi.log.err(["["+o+" -> "+n[s]+'] undefined "item_id" (String is expected)',e.id])):r.push({id:e.item_id,name:e.item_name||void 0,price:e.price||void 0,description:e.item_brand||e.item_variant||void 0}),(sndsyApi.isU(e.item_name)||"string"!=typeof e.item_name||""==e.item_name)&&sndsyApi.log.warnSSecValue(o+" -> "+n[s],"item_name",e.name,"String"),!sndsyApi.isU(e.price)&&sndsyApi.isNumeric(e.price)||sndsyApi.log.warnSSecValue(o+" -> "+n[s],"price",e.price,"Number")})),a||sndsyApi.ssecEvent(n[s],r,{},{dataLayerWatchMode:!0})}else if("add_to_cart"==s){let e=[],t=0;i.items.forEach((s=>{c(s,{event:"BASKET_ADD"})?(e.push({id:s.item_id,name:s.item_name||void 0,price:s.price,qnt:s.quantity,description:s.item_brand||s.item_variant||void 0}),t+=s.quantity*s.price):a=!0})),a||(r.push({update_per_item:1,items:e}),sndsyApi.ssecEvent("BASKET_ADD",r,{},{dataLayerWatchMode:!0}))}else if("remove_from_cart"==s){let e=[];i.items.forEach((t=>{c(t,{event:"BASKET_ADD",remove:!0})?e.push({id:t.item_id,name:t.item_name||void 0,price:0,qnt:0,description:t.item_brand||t.item_variant||void 0}):a=!0})),a||(r.push({transaction_sum:0,update_per_item:1,items:e}),sndsyApi.ssecEvent("BASKET_ADD",r,{},{dataLayerWatchMode:!0}))}else if("purchase"==s){if((sndsyApi.isU(i.transaction_id)||""==i.transaction_id)&&(a=!0,sndsyApi.log.err(["["+o+' -> ORDER] undefined "transaction_id" (String is expected)']),sndsyApi.log.msg(i)),!a){let e=0,t=i.items.reduce((function(t,s){return a||(c(s,{event:"ORDER"})?(e+=parseInt(s.quantity,10)*parseInt(s.price,10),t.push({id:s.item_id,name:s.item_name||void 0,price:s.price,qnt:s.quantity,description:s.item_brand||s.item_variant||void 0})):a=!0),t}),[]);a||(r.push({transaction_id:i.transaction_id,transaction_sum:e,transaction_status:1,transaction_dt:sndsyApi.dateFormat(),items:t}),sndsyApi.ssecEvent("ORDER",r,{},{dataLayerWatchMode:!0}))}}else if("view_item_list"==s){let e=[];(sndsyApi.isU(i.item_list_name)||"string"!=typeof i.item_list_name||""==i.item_list_name)&&(a=!0,sndsyApi.log.err(["["+o+' -> VIEW_CATEGORY] undefined "item_list_name" (String is expected)']),sndsyApi.log.msg(i)),Array.isArray(i.items)&&i.items.length&&(e=["","1","2","3","4","5"].reduce(((e,t)=>{let s=i.items[0]["item_category"+t]||!1;return s&&e.push(s),e}),[])),a||sndsyApi.ssecEvent("VIEW_CATEGORY",[{category:i.item_list_name,category_paths:e}],{},{dataLayerWatchMode:!0})}}};i.length&&(sndsyApi.isDevMode&&console.groupCollapsed("[Sendsay] dataLayer check before init proxy"),i.forEach((t=>{"ym"==e[s].dataLayerScheme&&sndsyApi.isObject(t)&&t.ecommerce?(sndsyApi.isDevMode&&sndsyApi.log.msg(["dataLayer before init",t]),r(t.ecommerce)):"ga4"==e[s].dataLayerScheme&&("arguments"==sndsyApi.typeOf(t)&&"event"==t[0]&&"string"==typeof t[1]&&sndsyApi.isObject(t[2])?(sndsyApi.isDevMode&&sndsyApi.log.msg(["dataLayer before init",t]),a("event",t[1],t[2])):"object"==sndsyApi.typeOf(t)&&"string"==typeof t.event&&sndsyApi.isObject(t.ecommerce)&&(sndsyApi.isDevMode&&sndsyApi.log.msg(["dataLayer before init proxy",t]),a("event",t.event,t.ecommerce)))})),sndsyApi.isDevMode&&console.groupEnd("[Sendsay] dataLayer check before init proxy")),i.push=new Proxy(i.push,{apply:function(t,i,n){return sndsyApi.isDevMode&&sndsyApi.log.msg(["dataLayer.push",n]),"ym"==e[s].dataLayerScheme&&n.length&&n[0]&&n[0].ecommerce?r(n[0].ecommerce):"ga4"==e[s].dataLayerScheme&&n.length&&(n[0].event&&n[0].ecommerce?(sndsyApi.isDevMode&&sndsyApi.log.msg(["by dataLayer.push method"]),a.apply(null,["event",n[0].event,n[0].ecommerce])):n[0].length&"event"==n[0][0]&&n[0][1]&&n[0][2]?(sndsyApi.isDevMode&&sndsyApi.log.msg(["by gtag function"]),a.apply(null,[n[0][0],n[0][1],n[0][2]])):n[0]&&n[0].ecommerce&&(sndsyApi.isDevMode&&sndsyApi.log.warn(["Try to Yandex Metrika scheme"]),r(n[0].ecommerce))),t.apply(i,n)}})}sndsyApi.isDevMode&&(sndsyApi.log.msg(["Sendsay Tracking v.2024.11.12 11:30:00"]),e[s].debug=!0)}(window,document,"sndsy_params");